<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>konfoo.core - KonFoo 2.1.0</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">KonFoo 2.1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">KonFoo 2.1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../content/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/concept.html">Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/mapper.html">Mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/fields.html">Fields</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Containers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../containers/structure.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../containers/sequence.html">Sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../containers/array.html">Array</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pointers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pointers/index.html">Pointer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Providers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../providers/index.html">Provider</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bytestream</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bytestream/reading.html">Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bytestream/writing.html">Writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bytestream/deserializing.html">De-Serializing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Annex</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../annex/changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../annex/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../annex/contributing.html">Issue Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Indexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Symbol Index</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for konfoo.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""</span>
<span class="sd">core.py</span>
<span class="sd">~~~~~~~</span>
<span class="sd">&lt;Add description of the module here&gt;.</span>

<span class="sd">:copyright: (c) 2015-2020 by Jochen Gerhaeusser.</span>
<span class="sd">:license: BSD, see LICENSE for details</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">konfoo.categories</span> <span class="kn">import</span> <span class="n">Category</span>
<span class="kn">from</span> <span class="nn">konfoo.enums</span> <span class="kn">import</span> <span class="n">Enumeration</span>
<span class="kn">from</span> <span class="nn">konfoo.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ByteOrderTypeError</span><span class="p">,</span> <span class="n">ByteOrderValueError</span><span class="p">,</span>
    <span class="n">EnumTypeError</span><span class="p">,</span> <span class="n">FactoryTypeError</span><span class="p">,</span> <span class="n">MemberTypeError</span><span class="p">,</span>
    <span class="n">ProviderTypeError</span><span class="p">,</span> <span class="n">ContainerLengthError</span><span class="p">,</span>
    <span class="n">FieldAddressError</span><span class="p">,</span> <span class="n">FieldAlignmentError</span><span class="p">,</span> <span class="n">FieldByteOrderError</span><span class="p">,</span>
    <span class="n">FieldIndexError</span><span class="p">,</span> <span class="n">FieldSizeError</span><span class="p">,</span> <span class="n">FieldTypeError</span><span class="p">,</span> <span class="n">FieldValueError</span><span class="p">,</span>
    <span class="n">FieldValueEncodingError</span><span class="p">,</span>
    <span class="n">FieldGroupByteOrderError</span><span class="p">,</span> <span class="n">FieldGroupOffsetError</span><span class="p">,</span> <span class="n">FieldGroupSizeError</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">konfoo.globals</span> <span class="kn">import</span> <span class="n">ItemClass</span><span class="p">,</span> <span class="n">Byteorder</span><span class="p">,</span> <span class="n">BYTEORDER</span><span class="p">,</span> <span class="n">clamp</span>
<span class="kn">from</span> <span class="nn">konfoo.options</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Option</span><span class="p">,</span>
    <span class="n">byte_order_option</span><span class="p">,</span> <span class="n">get_byte_order</span><span class="p">,</span> <span class="n">nested_option</span><span class="p">,</span> <span class="n">get_nested</span><span class="p">,</span>
    <span class="n">verbose_option</span><span class="p">,</span> <span class="n">verbose</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">konfoo.providers</span> <span class="kn">import</span> <span class="n">Provider</span>


<span class="k">def</span> <span class="nf">is_any</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">Field</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">is_provider</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Provider</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_field</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Field</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_container</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Structure</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">is_sequence</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_array</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Array</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_structure</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Structure</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_mapping</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_pointer</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Pointer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_mixin</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">is_container</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="c1"># Memory Patch</span>
<span class="n">Patch</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Patch'</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'buffer'</span><span class="p">,</span>
    <span class="s1">'address'</span><span class="p">,</span>
    <span class="s1">'byteorder'</span><span class="p">,</span>
    <span class="s1">'bit_size'</span><span class="p">,</span>
    <span class="s1">'bit_offset'</span><span class="p">,</span>
    <span class="s1">'inject'</span><span class="p">])</span>
<span class="sd">""" The `Patch` class contains the relevant information to patch a memory area</span>
<span class="sd">of a `data source` accessed via a data :class:`Provider` by a :class:`Pointer`</span>
<span class="sd">field.</span>

<span class="sd">:param bytes buffer: byte stream for the memory area to patch in the data</span>
<span class="sd">    source. The byte stream contains the data of the patch item.</span>
<span class="sd">:param int address: address of the memory area to patch in the data source.</span>
<span class="sd">:param byteorder: :class:`Byteorder` of the memory area to patch in the data</span>
<span class="sd">    source.</span>
<span class="sd">:param int bit_size: bit size of the patch item.</span>
<span class="sd">:param int bit_offset: bit offset of the patch item within the memory area.</span>
<span class="sd">:param bool inject: if ``True`` the patch item must be injected into the</span>
<span class="sd">    memory area of the data source.</span>
<span class="sd">"""</span>

<span class="c1"># Field Index</span>
<span class="n">Index</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Index'</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'byte'</span><span class="p">,</span>
    <span class="s1">'bit'</span><span class="p">,</span>
    <span class="s1">'address'</span><span class="p">,</span>
    <span class="s1">'base_address'</span><span class="p">,</span>
    <span class="s1">'update'</span><span class="p">])</span>
<span class="sd">""" The `Index` class contains the relevant information of the location of a</span>
<span class="sd">:class:`Field` in a `byte stream` and in a `data source`. The `byte stream` is</span>
<span class="sd">normally provided by a :class:`Pointer` field. The `data source` is normally</span>
<span class="sd">accessed via a data :class:`Provider` by a :class:`Pointer` field.</span>

<span class="sd">:param int byte: byte offset of the :class:`Field` in the byte stream.</span>
<span class="sd">:param int bit: bit offset of the :class:`Field` relative to its byte offset.</span>
<span class="sd">:param int address: address of the :class:`Field` in the data source.</span>
<span class="sd">:param int base_address: start address of the byte stream in the data source.</span>
<span class="sd">:param bool update: if ``True`` the byte stream needs to be updated.</span>
<span class="sd">"""</span>
<span class="n">Index</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Field Alignment</span>
<span class="n">Alignment</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Alignment'</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'byte_size'</span><span class="p">,</span>
    <span class="s1">'bit_offset'</span><span class="p">])</span>
<span class="sd">""" The `Alignment` class contains the location of the :class:`Field` within an </span>
<span class="sd">aligned group of consecutive fields.</span>

<span class="sd">:param int byte_size: size of the *field group* in bytes </span>
<span class="sd">    which the :class:`Field` is aligned to.</span>
<span class="sd">:param int bit_offset: bit offset of the :class:`Field` </span>
<span class="sd">    within its aligned *field group*.</span>
<span class="sd">"""</span>
<span class="n">Alignment</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CategoryJSONEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Category</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../api/index.html#konfoo.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
    <span class="sd">""" The `Container` class is an *abstract interface* for all classes which</span>
<span class="sd">    can contain :class:`Field` items. Container classes are :class:`Structures</span>
<span class="sd">    &lt;Structure&gt;`, :class:`Sequences &lt;Sequence&gt;`, :class:`Arrays &lt;Array&gt;` and</span>
<span class="sd">    :class:`Pointers &lt;Pointer&gt;`.</span>

<span class="sd">    The `Container` class provides core features to **view**, **save** and</span>
<span class="sd">    **load** the *attributes* of the :class:`Field` items in the `Container`.</span>
<span class="sd">    """</span>

<div class="viewcode-block" id="Container.view_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.view_fields">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">view_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a container with the selected field *attribute* or with the</span>
<span class="sd">        dictionary of the selected field *attributes* for each :class:`Field`</span>
<span class="sd">        *nested* in the `Container`.</span>

<span class="sd">        The *attributes* of each :class:`Field` for containers *nested* in the</span>
<span class="sd">        `Container` are viewed as well (chained method call).</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*. Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` views their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>

<span class="sd">        .. note::</span>
<span class="sd">            This abstract method must be implemented by a derived class.</span>
<span class="sd">        """</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Container.to_json"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.to_json">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns the selected field *attributes* for each :class:`Field`</span>
<span class="sd">        *nested* in the `Container` as a JSON formatted string.</span>

<span class="sd">        The *attributes* of each :class:`Field` for containers *nested* in the</span>
<span class="sd">        `Container` are viewed as well (chained method call).</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*.</span>
<span class="sd">            Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` views their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">nested</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'nested'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'fieldnames'</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'cls'</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span>
                                               <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                                               <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">),</span>
                              <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span>
                                               <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                                               <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">),</span>
                              <span class="bp">cls</span><span class="o">=</span><span class="n">_CategoryJSONEncoder</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Container.field_items"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.field_items">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">field_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of ``('field path', field item)`` tuples</span>
<span class="sd">        for each :class:`Field` *nested* in the `Container`.</span>

<span class="sd">        :param str path: item path.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`~Pointer.data` objects of all :class:`Pointer` fields in</span>
<span class="sd">            the `Container` list their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field items as well (chained method call).</span>

<span class="sd">        .. note::</span>
<span class="sd">            This abstract method must be implemented by a derived class.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">()</span></div>

<div class="viewcode-block" id="Container.to_list"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.to_list">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of ``('field path', attribute)`` or</span>
<span class="sd">        ``('field path', tuple(attributes))`` tuples for each :class:`Field`</span>
<span class="sd">        *nested* in the `Container`.</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword str name: name of the `Container`.</span>
<span class="sd">            Default is the class name of the instance.</span>
<span class="sd">        :keyword bool chain: if ``True`` the field *attributes* are chained to its</span>
<span class="sd">            field path. Defaults to ``False``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` lists their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>

        <span class="c1"># Name of the Container</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
            <span class="n">field_path</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">if</span> <span class="n">field_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'['</span><span class="p">):</span>
                <span class="c1"># Sequence</span>
                <span class="n">field_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'chain'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field_path</span><span class="p">,</span> <span class="o">*</span><span class="n">field_getter</span><span class="p">(</span><span class="n">field</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field_path</span><span class="p">,</span> <span class="n">field_getter</span><span class="p">(</span><span class="n">field</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">fields</span></div>

<div class="viewcode-block" id="Container.to_dict"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.to_dict">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** :class:`dict` of ``{'field path': attribute}``</span>
<span class="sd">        or ``{'field path': tuple(attributes)}`` pairs for each :class:`Field`</span>
<span class="sd">        *nested* in the `Container`.</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword str name: name of the `Container`.</span>
<span class="sd">            Default is the class name of the instance.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` lists their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="c1"># Name of the Container</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="c1"># Save to file</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'save'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
            <span class="n">field_path</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">field_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'['</span><span class="p">):</span>
                <span class="c1"># Sequence element</span>
                <span class="n">field_path</span> <span class="o">=</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">field_path</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_getter</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fields</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_fieldnames</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Default dictionary keys</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
        <span class="c1"># Customized dictionary keys</span>
        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'fieldnames'</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

<div class="viewcode-block" id="Container.to_csv"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.to_csv">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of dictionaries containing the field *path*</span>
<span class="sd">        and the selected field *attributes* for each :class:`Field` *nested* in the</span>
<span class="sd">        `Container`.</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword str name: name of the `Container`.</span>
<span class="sd">            Default is the class name of the instance.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the field *path*</span>
<span class="sd">            and the selected field *attributes*.</span>
<span class="sd">            Defaults to ``('id', *attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` lists their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fieldnames</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">'chain'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">field</span><span class="p">))</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Container.write_csv"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.write_csv">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Writes the field *path* and the selected field *attributes* for each</span>
<span class="sd">        :class:`Field` *nested* in the `Container` to  a ``.csv`` *file*.</span>

<span class="sd">        :param str file: name and location of the ``.csv`` *file*.</span>
<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword str name: name of the `Container`.</span>
<span class="sd">            Default is the class name of the instance.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the field *path*</span>
<span class="sd">            and the selected field *attributes*.</span>
<span class="sd">            Defaults to ``('id', *attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` lists their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fieldnames</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">file_</span><span class="p">,</span> <span class="n">fieldnames</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

<div class="viewcode-block" id="Container.write_json"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.write_json">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">write_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Writes the selected field *attributes* for each :class:`Field`</span>
<span class="sd">        *nested* in the `Container` to  a ``.json`` *file*.</span>

<span class="sd">        :param str file: name and location of the ``.json`` *file*.</span>
<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*.</span>
<span class="sd">            Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` lists their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">file_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="Container.save"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.save">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Saves the selected field *attributes* for each :class:`Field` *nested*</span>
<span class="sd">        in the `Container` to an ``.ini`` *file*.</span>

<span class="sd">        :param str file: name and location of the ``.ini`` *file*.</span>
<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword str section: section in the ``.ini`` file to look for the</span>
<span class="sd">            :class:`Field` values of the `Container`. If no *section* is</span>
<span class="sd">            specified the class name of the instance is used.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` saves their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; class Foo(Structure):</span>
<span class="sd">        ...     def __init__(self):</span>
<span class="sd">        ...         super().__init__()</span>
<span class="sd">        ...         self.stream = Stream()</span>
<span class="sd">        ...         self.float = Float()</span>
<span class="sd">        ...         self.structure = Structure()</span>
<span class="sd">        ...         self.structure.decimal = Decimal(8)</span>
<span class="sd">        ...         self.array = Array(Byte, 3)</span>
<span class="sd">        ...         self.pointer = Pointer()</span>
<span class="sd">        &gt;&gt;&gt; foo = Foo()</span>
<span class="sd">        &gt;&gt;&gt; foo.to_list(nested=True)</span>
<span class="sd">        [('Foo.stream', ''),</span>
<span class="sd">         ('Foo.float', 0.0),</span>
<span class="sd">         ('Foo.structure.decimal', 0),</span>
<span class="sd">         ('Foo.array[0]', '0x0'),</span>
<span class="sd">         ('Foo.array[1]', '0x0'),</span>
<span class="sd">         ('Foo.array[2]', '0x0'),</span>
<span class="sd">         ('Foo.pointer', '0x0')]</span>
<span class="sd">        &gt;&gt;&gt; foo.to_json(nested=True)</span>
<span class="sd">        '{"stream": "",</span>
<span class="sd">          "float": 0.0,</span>
<span class="sd">          "structure": {"decimal": 0},</span>
<span class="sd">          "array": ["0x0", "0x0", "0x0"],</span>
<span class="sd">          "pointer": {"value": "0x0",</span>
<span class="sd">                      "data": null}}'</span>
<span class="sd">        &gt;&gt;&gt; foo.save('foo.ini')</span>

<span class="sd">        File `foo.ini`:</span>

<span class="sd">        .. code-block:: ini</span>

<span class="sd">            [Foo]</span>
<span class="sd">            stream =</span>
<span class="sd">            float = 0.0</span>
<span class="sd">            structure.decimal = 0</span>
<span class="sd">            array[0] = 0x0</span>
<span class="sd">            array[1] = 0x0</span>
<span class="sd">            array[2] = 0x0</span>
<span class="sd">            pointer = 0x0</span>
<span class="sd">        """</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">'save'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
        <span class="n">file_</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Container.load"><a class="viewcode-back" href="../../api/index.html#konfoo.Container.load">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="nd">@verbose_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Loads the field *value* for each :class:`Field` *nested* in the</span>
<span class="sd">        `Container` from an ``.ini`` *file*.</span>

<span class="sd">        :param str file: name and location of the ``.ini`` *file*.</span>
<span class="sd">        :keyword str section: section in the ``.ini`` *file* to lookup the</span>
<span class="sd">            value for each :class:`Field` in the `Container`.</span>
<span class="sd">            If no *section* is specified the class name of the instance is used.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Container` load their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field valus as well (chained method call).</span>
<span class="sd">        :keyword bool verbose: if ``True`` the loading is executed in verbose</span>
<span class="sd">            mode.</span>

<span class="sd">        File `foo.ini`:</span>

<span class="sd">        .. code-block:: ini</span>

<span class="sd">            [Foo]</span>
<span class="sd">            stream =</span>
<span class="sd">            float = 0.0</span>
<span class="sd">            structure.decimal = 0</span>
<span class="sd">            array[0] = 0x0</span>
<span class="sd">            array[1] = 0x0</span>
<span class="sd">            array[2] = 0x0</span>
<span class="sd">            pointer = 0x0</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; class Foo(Structure):</span>
<span class="sd">        ...     def __init__(self):</span>
<span class="sd">        ...         super().__init__()</span>
<span class="sd">        ...         self.stream = Stream()</span>
<span class="sd">        ...         self.float = Float()</span>
<span class="sd">        ...         self.structure = Structure()</span>
<span class="sd">        ...         self.structure.decimal = Decimal(8)</span>
<span class="sd">        ...         self.array = Array(Byte, 3)</span>
<span class="sd">        ...         self.pointer = Pointer()</span>
<span class="sd">        &gt;&gt;&gt; foo = Foo()</span>
<span class="sd">        &gt;&gt;&gt; foo.load('foo.ini')</span>
<span class="sd">        [Foo]</span>
<span class="sd">        Foo.stream =</span>
<span class="sd">        Foo.float = 0.0</span>
<span class="sd">        Foo.structure.decimal = 0</span>
<span class="sd">        Foo.array[0] = 0x0</span>
<span class="sd">        Foo.array[1] = 0x0</span>
<span class="sd">        Foo.array[2] = 0x0</span>
<span class="sd">        Foo.pointer = 0x0</span>
<span class="sd">        &gt;&gt;&gt; foo.to_list(nested=True)</span>
<span class="sd">        [('Foo.stream', ''),</span>
<span class="sd">         ('Foo.float', 0.0),</span>
<span class="sd">         ('Foo.structure.decimal', 0),</span>
<span class="sd">         ('Foo.array[0]', '0x0'),</span>
<span class="sd">         ('Foo.array[1]', '0x0'),</span>
<span class="sd">         ('Foo.array[2]', '0x0'),</span>
<span class="sd">         ('Foo.pointer', '0x0')]</span>
<span class="sd">        &gt;&gt;&gt; foo.to_json(nested=True)</span>
<span class="sd">        '{"stream": "",</span>
<span class="sd">          "float": 0.0,</span>
<span class="sd">          "structure": {"decimal": 0},</span>
<span class="sd">          "array": ["0x0", "0x0", "0x0"],</span>
<span class="sd">          "pointer": {"value": "0x0",</span>
<span class="sd">                      "data": null}}'</span>
<span class="sd">        """</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'section'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
            <span class="n">verbose</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2">]"</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">field_path</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'['</span><span class="p">):</span>
                    <span class="c1"># Sequence element</span>
                    <span class="n">option</span> <span class="o">=</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">field_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">option</span> <span class="o">=</span> <span class="n">field_path</span>
                <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
                    <span class="c1"># Bool fields</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">is_bool</span><span class="p">():</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
                    <span class="c1"># Float fields</span>
                    <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">is_float</span><span class="p">():</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
                    <span class="c1"># String fields</span>
                    <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">is_string</span><span class="p">():</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
                    <span class="c1"># Stream fields</span>
                    <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">is_stream</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
                        <span class="n">stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"'"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
                        <span class="c1"># Auto size a zero sized stream field to the current length</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="p">:</span>
                            <span class="n">field</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stream</span><span class="p">))</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">stream</span>
                    <span class="c1"># Decimal fields</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">field_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'['</span><span class="p">):</span>
                        <span class="n">verbose</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">section</span><span class="si">}{</span><span class="n">field_path</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">verbose</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">field_path</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbose</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"No section [</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2">] found."</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Structure"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure">[docs]</a><span class="k">class</span> <span class="nc">Structure</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
    <span class="sd">""" A `Structure` is a :class:`dict` whereby the dictionary `key` describes</span>
<span class="sd">    the *name* of a *member* of the `Structure` and the `value` of the dictionary</span>
<span class="sd">    `key` describes the *type* of the *member*. Allowed *members* are</span>
<span class="sd">    :class:`Structure`, :class:`Sequence`, :class:`Array` or :class:`Field`</span>
<span class="sd">    instances.</span>

<span class="sd">    The `Structure` class extends the :class:`dict` with the :class:`Container`</span>
<span class="sd">    interface and attribute getter and setter for the ``{'key': value}`` pairs</span>
<span class="sd">    to access and to assign the *members* of the `Structure` easier, but this</span>
<span class="sd">    comes with the trade-off that the dictionary `keys` must be valid Python</span>
<span class="sd">    attribute names.</span>

<span class="sd">    A `Structure` has additional methods to **read**, **deserialize**,</span>
<span class="sd">    **serialize** and **view** binary data:</span>

<span class="sd">    * **Read** from a :class:`Provider` the necessary bytes for each</span>
<span class="sd">      :attr:`~Pointer.data` object referenced by the :class:`Pointer` fields</span>
<span class="sd">      in the `Structure` via :meth:`read_from()`.</span>
<span class="sd">    * **Deserialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the `Structure` from a byte stream via :meth:`deserialize()`.</span>
<span class="sd">    * **Serialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the `Structure` to a byte stream via :meth:`serialize()`.</span>
<span class="sd">    * Indexes all fields in the `Structure`</span>
<span class="sd">      via :meth:`index_fields()`.</span>
<span class="sd">    * Get the **first** :class:`Field` in the `Structure`</span>
<span class="sd">      via :meth:`first_field()`.</span>
<span class="sd">    * Get the accumulated **size** of all fields in the `Structure`</span>
<span class="sd">      via :meth:`container_size()`.</span>
<span class="sd">    * View the selected *attributes* for each :class:`Field` in the `Structure`</span>
<span class="sd">      via :meth:`view_fields()`.</span>
<span class="sd">    * List the **path** to the field and the field **item** itself for each</span>
<span class="sd">      :class:`Field` in the `Structure` as a flatten list via :meth:`field_items()`.</span>
<span class="sd">    * Get the **metadata** of the `Structure` via :meth:`describe()`.</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Structure.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Structure</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1"># Structure</span>
        <span class="k">if</span> <span class="n">is_structure</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="c1"># Dictionaries</span>
        <span class="k">elif</span> <span class="n">is_mapping</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Structure</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="c1"># Sequence</span>
        <span class="k">elif</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">""" Returns the :class:`Field` of the `Structure` member whose dictionary</span>
<span class="sd">        key is equal to the *name*.</span>

<span class="sd">        If the attribute *name* is in the namespace of the `Structure` class</span>
<span class="sd">        then the base class is called instead.</span>

<span class="sd">        The `__getattr__` method is only called when the method</span>
<span class="sd">        `__getattribute__` raises an `AttributeError` exception.</span>
<span class="sd">        """</span>
        <span class="c1"># Namespace check for dict attribute</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="si">}</span><span class="s2">' object has not attribute '</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Assigns the *item* to the member of the `Structure` whose dictionary</span>
<span class="sd">        key is equal to the *name*.</span>

<span class="sd">        If the attribute *name* is in the namespace of the `Structure` base class</span>
<span class="sd">        then the base class is called instead.</span>
<span class="sd">        """</span>
        <span class="c1"># Attribute check</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_any</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="c1"># Field Factory</span>
            <span class="n">setitem</span> <span class="o">=</span> <span class="n">item</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_any</span><span class="p">(</span><span class="n">setitem</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">setitem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FactoryTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">setitem</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Structure.read_from"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.read_from">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" All :class:`Pointer` fields in the `Structure` read the necessary</span>
<span class="sd">        number of bytes from the data :class:`Provider` for their referenced</span>
<span class="sd">        :attr:`~Pointer.data` object. Null pointer are ignored.</span>

<span class="sd">        :param Provider provider: data :class:`Provider`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`~Pointer.data` objects of all :class:`Pointer` fields in the</span>
<span class="sd">            `Structure` reads their referenced :attr:`~Pointer.data` object as</span>
<span class="sd">            well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field stores the bytes for its referenced</span>
<span class="sd">            :attr:`~Pointer.data` object in its :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="c1"># Container or Pointer</span>
            <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Structure.deserialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.deserialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" De-serializes the `Structure` from the byte *buffer* starting at</span>
<span class="sd">        the begin of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        bytes to the :attr:`~Field.value` for each :class:`Field` in the</span>
<span class="sd">        `Structure` in accordance with the decoding *byte order* for the</span>
<span class="sd">        de-serialization and the decoding :attr:`byte_order` of each</span>
<span class="sd">        :class:`Field` in the `Structure`.</span>

<span class="sd">        A specific decoding :attr:`~Field.byte_order` of a :class:`Field`</span>
<span class="sd">        overrules the decoding *byte order* for the de-serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the last de-serialized</span>
<span class="sd">        :class:`Field` in the `Structure`.</span>

<span class="sd">        Optional the de-serialization of the referenced :attr:`~Pointer.data`</span>
<span class="sd">        objects of all :class:`Pointer` fields in the `Structure` can be</span>
<span class="sd">        enabled.</span>

<span class="sd">        :param bytes buffer: byte stream.</span>
<span class="sd">        :param Index index: current read :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of a</span>
<span class="sd">            `Structure` de-serialize their referenced :attr:`~Pointer.data`</span>
<span class="sd">            object as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the de-serialization of its</span>
<span class="sd">            referenced  :attr:`~Pointer.data` object its own</span>
<span class="sd">            :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Structure.serialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.serialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Serializes the `Structure` to the byte *buffer* starting at begin</span>
<span class="sd">        of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        :attr:`~Field.value` for each :class:`Field` in the `Structure` to the</span>
<span class="sd">        byte *buffer* in accordance with the encoding *byte order* for the</span>
<span class="sd">        serialization and the encoding :attr:`byte_order` of each :class:`Field`</span>
<span class="sd">        in the `Structure`.</span>

<span class="sd">        A specific encoding :attr:`~Field.byte_order` of a :class:`Field`</span>
<span class="sd">        overrules the encoding *byte order* for the serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the last serialized</span>
<span class="sd">        :class:`Field` in the `Structure`.</span>

<span class="sd">        Optional the serialization of the referenced :attr:`~Pointer.data`</span>
<span class="sd">        objects of all :class:`Pointer` fields in the `Structure` can be</span>
<span class="sd">        enabled.</span>

<span class="sd">        :param bytearray buffer: byte stream.</span>
<span class="sd">        :param Index index: current write :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of a</span>
<span class="sd">            `Structure` serialize their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the serialization of its</span>
<span class="sd">            referenced :attr:`~Pointer.data` object its own</span>
<span class="sd">            :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Structure.index_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.index_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">index_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Indexes all fields in the `Structure` starting with the given</span>
<span class="sd">        *index* and returns the :class:`Index` after the last :class:`Field`</span>
<span class="sd">        in the `Structure`.</span>

<span class="sd">        :param Index index: start :class:`Index` for the first :class:`Field`</span>
<span class="sd">            in the `Structure`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of the</span>
<span class="sd">            `Structure` indexes their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            fields as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_fields</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">index_data</span><span class="p">()</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Structure.container_size"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.container_size">[docs]</a>    <span class="k">def</span> <span class="nf">container_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the accumulated bit size of all fields in the `Structure` as</span>
<span class="sd">        a tuple in the form of ``(number of bytes, remaining number of bits)``.</span>
<span class="sd">        """</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">byte_length</span><span class="p">,</span> <span class="n">bit_length</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">container_size</span><span class="p">()</span>
                <span class="n">length</span> <span class="o">+=</span> <span class="n">bit_length</span> <span class="o">+</span> <span class="n">byte_length</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">length</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">bit_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="Structure.first_field"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.first_field">[docs]</a>    <span class="k">def</span> <span class="nf">first_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the first :class:`Field` in the `Structure` or ``None``</span>
<span class="sd">        for an empty `Structure`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">first_field</span><span class="p">()</span>
                <span class="c1"># Container is not empty</span>
                <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">field</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Structure.initialize_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.initialize_fields">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">""" Initializes the :class:`Field` members in the `Structure` with</span>
<span class="sd">        the *values* in the *content* dictionary.</span>

<span class="sd">        :param dict content: a dictionary contains the :class:`Field`</span>
<span class="sd">            values for each member in the `Structure`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Container or Pointer</span>
            <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># Fields</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Structure.view_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.view_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">view_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns an :class:`dict` which contains the ``{'member name':</span>
<span class="sd">        field attribute}`` or the  ``{'member name': dict(field attributes)}``</span>
<span class="sd">        pairs for each :class:`Field` *nested* in the `Structure`.</span>

<span class="sd">        The *attributes* of each :class:`Field` for containers *nested* in the</span>
<span class="sd">        `Structure` are viewed as well (chained method call).</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*. Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields nested in</span>
<span class="sd">            the `Structure` views their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="n">members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'fieldnames'</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                    <span class="n">members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">field_getter</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">members</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_getter</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">members</span></div>

<div class="viewcode-block" id="Structure.field_items"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.field_items">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">field_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of ``('field path', field item)`` tuples</span>
<span class="sd">        for each :class:`Field` *nested* in the `Structure`.</span>

<span class="sd">        :param str path: field path of the `Structure`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`~Pointer.data` objects of all :class:`Pointer` fields in</span>
<span class="sd">            the `Structure` list their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field items as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">path</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="nb">str</span><span class="p">()</span>

        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">parent</span> <span class="k">else</span> <span class="n">name</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">item_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">item_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item_path</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">item_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="Structure.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Structure.describe">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns the **metadata** of the `Structure` as a :class:`dict`.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            metadata = {</span>
<span class="sd">                'class': self.__class__.__name__,</span>
<span class="sd">                'name': name if name else self.__class__.__name__,</span>
<span class="sd">                'size': len(self),</span>
<span class="sd">                'type': Structure.item_type.name</span>
<span class="sd">                'member': [</span>
<span class="sd">                    item.describe(member) for member, item in self.items()</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">        :param str name: optional name for the `Structure`.</span>
<span class="sd">            Fallback is the class name.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of the</span>
<span class="sd">            `Structure` lists their referenced :attr:`~Pointer.data` object fields</span>
<span class="sd">            as well (chained method call). Default is ``True``.</span>
<span class="sd">        """</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'member'</span><span class="p">]</span> <span class="o">=</span> <span class="n">members</span>

        <span class="k">for</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">member_name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">member_name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">member_name</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">member_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span></div></div>


<div class="viewcode-block" id="Sequence"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence">[docs]</a><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
    <span class="sd">""" A `Sequence` is a mutable sequence containing heterogeneous *items*</span>
<span class="sd">    and is extended with the :class:`Container` interface. Allowed *items*</span>
<span class="sd">    are :class:`Structure`, :class:`Sequence`, :class:`Array` or :class:`Field`</span>
<span class="sd">    instances.</span>

<span class="sd">    A `Sequence` is:</span>

<span class="sd">    * *containable*: ``item`` in ``self`` returns ``True`` if *item* is in the</span>
<span class="sd">      `Sequence`.</span>
<span class="sd">    * *sized*: ``len(self)`` returns the number of items in the `Sequence`.</span>
<span class="sd">    * *indexable* ``self[index]`` returns the *item* at the *index*</span>
<span class="sd">      of the `Sequence`.</span>
<span class="sd">    * *iterable* ``iter(self)`` iterates over the *items* in the `Sequence`</span>

<span class="sd">    A `Sequence` supports the usual methods for sequences:</span>

<span class="sd">    * **Append** an item to the `Sequence` via :meth:`append()`.</span>
<span class="sd">    * **Insert** an item before the *index* into the `Sequence`</span>
<span class="sd">      via :meth:`insert()`.</span>
<span class="sd">    * **Extend** the `Sequence` with items via :meth:`extend()`.</span>
<span class="sd">    * **Clear** the `Sequence` via :meth:`clear()`.</span>
<span class="sd">    * **Pop** an item with the *index* from the `Sequence` via :meth:`pop()`.</span>
<span class="sd">    * **Remove** the first occurrence of an *item* from the `Sequence`</span>
<span class="sd">      via :meth:`remove()`.</span>
<span class="sd">    * **Reverse** all items in the `Sequence` via :meth:`reverse()`.</span>

<span class="sd">    A `Sequence` has additional methods to **read**, **deserialize**,</span>
<span class="sd">    **serialize** and **view** binary data:</span>

<span class="sd">    * **Read** from a :class:`Provider` the necessary bytes for each</span>
<span class="sd">      :attr:`~Pointer.data` object referenced by the :class:`Pointer` fields</span>
<span class="sd">      in the `Sequence` via :meth:`read_from()`.</span>
<span class="sd">    * **Deserialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the `Sequence` from a byte stream via :meth:`deserialize()`.</span>
<span class="sd">    * **Serialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the `Sequence` to a byte stream via :meth:`serialize()`.</span>
<span class="sd">    * Indexes all fields in the `Sequence` via :meth:`index_fields()`.</span>
<span class="sd">    * Get the **first** :class:`Field`</span>
<span class="sd">      in the `Sequence` via :meth:`first_field()`.</span>
<span class="sd">    * Get the accumulated **size** of all fields in the `Sequence`</span>
<span class="sd">      via :meth:`container_size()`.</span>

<span class="sd">    * View the selected *attributes* for each :class:`Field`</span>
<span class="sd">      in the `Sequence` via :meth:`view_fields()`.</span>
<span class="sd">    * List the **path** to the field and the field **item** itself for each</span>
<span class="sd">      :class:`Field` in the `Sequence` as a flatten list via :meth:`field_items()`.</span>
<span class="sd">    * Get the **metadata** of the `Sequence` via :meth:`describe()`.</span>

<span class="sd">    :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">        :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">        *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">        is appended to the `Sequence`.</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Sequence.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Sequence</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Data object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">iterable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">is_any</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">member</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_any</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="n">member</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_any</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

<div class="viewcode-block" id="Sequence.append"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Appends the *item* to the end of the `Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_any</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Inserts the *item* before the *index* into the `Sequence`.</span>

<span class="sd">        :param int index: `Sequence` index.</span>
<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_any</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.pop"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">""" Removes and returns the item at the *index* from the `Sequence`.</span>

<span class="sd">        :param int index: `Sequence` index.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.clear"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Remove all items from the `Sequence`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.remove"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Removes the first occurrence of an *item* from the `Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.reverse"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" In place reversing of the `Sequence` items."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.extend"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">""" Extends the `Sequence` by appending items from the *iterable*.</span>

<span class="sd">        :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">            :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">            *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">            is appended to the `Sequence`.</span>
<span class="sd">        """</span>
        <span class="c1"># Sequence</span>
        <span class="k">if</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="c1"># Structure</span>
        <span class="k">elif</span> <span class="n">is_structure</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterable</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">iterable</span><span class="p">])</span>
        <span class="c1"># Iterable</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Sequence</span><span class="p">(</span><span class="n">iterable</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="Sequence.read_from"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.read_from">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" All :class:`Pointer` fields in the `Sequence` read the necessary</span>
<span class="sd">        number of bytes from the data :class:`Provider` for their referenced</span>
<span class="sd">        :attr:`~Pointer.data` object. Null pointer are ignored.</span>

<span class="sd">        :param Provider provider: data :class:`Provider`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`~Pointer.data` objects of all :class:`Pointer` fields in the</span>
<span class="sd">            `Sequence` reads their referenced :attr:`~Pointer.data` object as</span>
<span class="sd">            well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field stores the bytes for its referenced</span>
<span class="sd">            :attr:`~Pointer.data` object in its :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Container or Pointer</span>
            <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.deserialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.deserialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" De-serializes the `Sequence` from the byte *buffer* starting at</span>
<span class="sd">        the begin of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        bytes to the :attr:`~Field.value` for each :class:`Field` in the</span>
<span class="sd">        `Sequence` in accordance with the decoding *byte order* for the</span>
<span class="sd">        de-serialization and the decoding :attr:`byte_order` of each</span>
<span class="sd">        :class:`Field` in the `Sequence`.</span>

<span class="sd">        A specific decoding :attr:`~Field.byte_order` of a :class:`Field`</span>
<span class="sd">        overrules the decoding *byte order* for the de-serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the last de-serialized</span>
<span class="sd">        :class:`Field` in the `Sequence`.</span>

<span class="sd">        Optional the de-serialization of the referenced :attr:`~Pointer.data`</span>
<span class="sd">        objects of all :class:`Pointer` fields in the `Sequence` can be</span>
<span class="sd">        enabled.</span>

<span class="sd">        :param bytes buffer: byte stream.</span>
<span class="sd">        :param Index index: current read :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of a</span>
<span class="sd">            `Sequence` de-serialize their referenced :attr:`~Pointer.data`</span>
<span class="sd">            object as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the de-serialization of its</span>
<span class="sd">            referenced :attr:`~Pointer.data` object its own</span>
<span class="sd">            :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Sequence.serialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.serialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Serializes the `Sequence` to the byte *buffer* starting at begin</span>
<span class="sd">        of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        :attr:`~Field.value` for each :class:`Field` in the `Sequence` to the</span>
<span class="sd">        byte *buffer* in accordance with the encoding *byte order* for the</span>
<span class="sd">        serialization and the encoding :attr:`byte_order` of each :class:`Field`</span>
<span class="sd">        in the `Sequence`.</span>

<span class="sd">        A specific encoding :attr:`~Field.byte_order` of a :class:`Field`</span>
<span class="sd">        overrules the encoding *byte order* for the serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the last serialized</span>
<span class="sd">        :class:`Field` in the `Sequence`.</span>

<span class="sd">        Optional the serialization of the referenced :attr:`~Pointer.data`</span>
<span class="sd">        objects of all :class:`Pointer` fields in the `Sequence` can be</span>
<span class="sd">        enabled.</span>

<span class="sd">        :param bytearray buffer: byte stream.</span>
<span class="sd">        :param Index index: current write :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields of a</span>
<span class="sd">            `Sequence` serialize their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the serialization of its</span>
<span class="sd">            referenced :attr:`~Pointer.data` object its own</span>
<span class="sd">            :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Sequence.index_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.index_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">index_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Indexes all fields in the `Sequence` starting with the given</span>
<span class="sd">        *index* and returns the :class:`Index` after the last :class:`Field`</span>
<span class="sd">        in the `Sequence`.</span>

<span class="sd">        :param Index index: start :class:`Index` for the first :class:`Field`</span>
<span class="sd">            in the `Sequence`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Sequence` indexes their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            fields as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_fields</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">index_data</span><span class="p">()</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Sequence.container_size"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.container_size">[docs]</a>    <span class="k">def</span> <span class="nf">container_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the accumulated bit size of all fields in the `Sequence` as</span>
<span class="sd">        a tuple in the form of ``(number of bytes, remaining number of bits)``.</span>
<span class="sd">        """</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">byte_length</span><span class="p">,</span> <span class="n">bit_length</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">container_size</span><span class="p">()</span>
                <span class="n">length</span> <span class="o">+=</span> <span class="n">bit_length</span> <span class="o">+</span> <span class="n">byte_length</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">length</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">bit_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.first_field"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.first_field">[docs]</a>    <span class="k">def</span> <span class="nf">first_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the first :class:`Field` in the `Sequence` or ``None``</span>
<span class="sd">        for an empty `Sequence`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">first_field</span><span class="p">()</span>
                <span class="c1"># Container is not empty</span>
                <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">field</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Sequence.initialize_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.initialize_fields">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">""" Initializes the :class:`Field` items in the `Sequence` with</span>
<span class="sd">        the *values* in the *content* list.</span>

<span class="sd">        :param list content: a list contains the :class:`Field` values for each</span>
<span class="sd">            item in the `Sequence`.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)):</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span>
            <span class="c1"># Container or Pointer</span>
            <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># Fields</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.view_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.view_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">view_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a list with the selected field *attribute* or a list with the</span>
<span class="sd">        dictionaries of the selected field *attributes* for each :class:`Field`</span>
<span class="sd">        *nested* in the `Sequence`.</span>

<span class="sd">        The *attributes* of each :class:`Field` for containers *nested* in the</span>
<span class="sd">        `Sequence` are viewed as well (chained method call).</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*. Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields nested in the</span>
<span class="sd">            `Sequence` views their referenced :attr:`~Pointer.data` object field</span>
<span class="sd">            attributes as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="c1"># Container</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="c1"># Pointer</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="c1"># Field</span>
                <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'fieldnames'</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">field_getter</span><span class="p">(</span><span class="n">item</span><span class="p">))))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_getter</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="Sequence.field_items"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.field_items">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">field_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of ``('field path', field item)`` tuples</span>
<span class="sd">        for each :class:`Field` *nested* in the `Sequence`.</span>

<span class="sd">        :param str path: field path of the `Sequence`.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`~Pointer.data` objects of all :class:`Pointer` fields in</span>
<span class="sd">            the `Sequence` list their referenced :attr:`~Pointer.data` object</span>
<span class="sd">            field items as well (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">item_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">]"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s2">]"</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">field_item</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">item_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_item</span><span class="p">)</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">field_item</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">item_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_item</span><span class="p">)</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item_path</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">item_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="Sequence.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Sequence.describe">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns the **metadata** of the `Sequence` as a :class:`dict`.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            metadata = {</span>
<span class="sd">                'class': self.__class__.__name__,</span>
<span class="sd">                'name': name if name else self.__class__.__name__,</span>
<span class="sd">                'size': len(self),</span>
<span class="sd">                'type': Sequence.item_type.name</span>
<span class="sd">                'member': [</span>
<span class="sd">                    item.describe('name[idx]') for idx, item in enumerate(self)</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">        :param str name: optional name for the `Sequence`.</span>
<span class="sd">            Fallback is the class name.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            `Sequence` lists their referenced :attr:`~Pointer.data` object fields</span>
<span class="sd">            as well (chained method call). Default is ``True``.</span>
<span class="sd">        """</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'member'</span><span class="p">]</span> <span class="o">=</span> <span class="n">members</span>

        <span class="k">for</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Container</span>
            <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">member_name</span><span class="si">}</span><span class="s2">]"</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="c1"># Pointer</span>
            <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">member_name</span><span class="si">}</span><span class="s2">]"</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
            <span class="c1"># Field</span>
            <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">member_name</span><span class="si">}</span><span class="s2">]"</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">member_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span></div></div>


<div class="viewcode-block" id="Array"><a class="viewcode-back" href="../../api/index.html#konfoo.Array">[docs]</a><span class="k">class</span> <span class="nc">Array</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">""" An `Array` is a :class:`Sequence` which contains *elements* of one type.</span>
<span class="sd">    The *template* for the *array element* can be any :class:`Field` instance or a</span>
<span class="sd">    *callable* (factory) which returns a :class:`Structure`, :class:`Sequence`,</span>
<span class="sd">    :class:`Array` or any :class:`Field` instance.</span>

<span class="sd">    A *callable template* (factory) is necessary to ensure that the internal</span>
<span class="sd">    constructor for the array element produces complete copies for each array element</span>
<span class="sd">    including the *nested* objects in the *template* for the array element.</span>

<span class="sd">    An `Array` of :class:`Pointer` fields should use a *callable* instead of</span>
<span class="sd">    assigning a :class:`Pointer` field instance directly as the array element</span>
<span class="sd">    *template* to ensure that the referenced :attr:`~Pointer.data` object of a</span>
<span class="sd">    :class:`Pointer` field is also complete copied for each array element.</span>

<span class="sd">    An `Array` adapts and extends a :class:`Sequence` with the following features:</span>

<span class="sd">    *   **Append** a new *array element* to the `Array` via :meth:`append()`.</span>
<span class="sd">    *   **Insert** a new *array element* before the *index* into the `Array`</span>
<span class="sd">        via :meth:`insert()`.</span>
<span class="sd">    *   **Re-size** the `Array` via :meth:`resize()`.</span>

<span class="sd">    An `Array` replaces the ``'type'`` key of the :attr:`~Sequence.metadata`</span>
<span class="sd">    of a :class:`Sequence` with its own `item` type.</span>

<span class="sd">    :param template: template for the *array element*.</span>
<span class="sd">        The *template* can be any :class:`Field` instance or any *callable*</span>
<span class="sd">        that returns a :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">        or any :class:`Field` instance.</span>
<span class="sd">    :param int capacity: capacity of the `Array` in number of *array elements*.</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Array.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Array</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Template for the array element.</span>
        <span class="k">if</span> <span class="n">is_field</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
            <span class="c1"># Field: Array element instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
            <span class="c1"># Callable: Array element factory</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">template</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_any</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">template</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FactoryTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>

        <span class="c1"># Create array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">capacity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__create__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">):</span>
            <span class="c1"># Field: Array element instance</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Callable: Array element factory</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">()</span>

<div class="viewcode-block" id="Array.append"><a class="viewcode-back" href="../../api/index.html#konfoo.Array.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Appends a new *array element* to the `Array`."""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__create__</span><span class="p">())</span></div>

<div class="viewcode-block" id="Array.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.Array.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">""" Inserts a new *array element* before the *index* of the `Array`.</span>

<span class="sd">        :param int index: `Array` index.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create__</span><span class="p">())</span></div>

<div class="viewcode-block" id="Array.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.Array.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capacity</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the `Array` by appending new *array elements* or</span>
<span class="sd">        removing *array elements* from the end.</span>

<span class="sd">        :param int capacity: new capacity of the `Array` in number of *array elements*.</span>
<span class="sd">        """</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">capacity</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="o">-</span><span class="n">count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">count</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Array.initialize_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Array.initialize_fields">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">""" Initializes the :class:`Field` elements in the `Array` with the</span>
<span class="sd">        *values* in the *content* list.</span>

<span class="sd">        If the *content* list is shorter than the `Array` then the *content*</span>
<span class="sd">        list is used as a rotating fill pattern for the :class:`Field` elements</span>
<span class="sd">        in the `Array`.</span>

<span class="sd">        :param list content: a list contains the :class:`Field` values for each</span>
<span class="sd">            element in the `Array` or one :class:`Field` value for all elements</span>
<span class="sd">            in the `Array`.</span>
<span class="sd">        """</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">capacity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">capacity</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">capacity</span><span class="p">],</span>
                                                <span class="n">content</span><span class="p">),</span>
                                            <span class="n">start</span><span class="o">=</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span>
                    <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                        <span class="c1"># Container or Pointer</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                        <span class="c1"># Fields</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="c1"># Container or Pointer</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="c1"># Fields</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Field"><a class="viewcode-back" href="../../api/index.html#konfoo.Field">[docs]</a><span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>
    <span class="sd">""" The `Field` class is the *abstract class* for all field classes.</span>

<span class="sd">    A `Field` has a specific **name**, **bit size**, **byte order**</span>
<span class="sd">    and can be **aligned to** other fields.</span>

<span class="sd">    A `Field` has methods to **unpack**, **pack**, **deserialize** and **serialize**</span>
<span class="sd">    its field **value** from and to a byte stream and stores its location within</span>
<span class="sd">    the byte stream and the providing data source in its field **index**.</span>

<span class="sd">    :param int bit_size: is the *size* of a `Field` in bits.</span>
<span class="sd">    :param int align_to: aligns the `Field` to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Field`.</span>
<span class="sd">        Default is :class:`~Byteorder.auto`.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Field</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Field index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">()</span>
        <span class="c1"># Field alignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span> <span class="o">=</span> <span class="n">align_to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_bit_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Field byte order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_byte_order</span> <span class="o">=</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="o">=</span> <span class="n">byte_order</span>
        <span class="c1"># Field bit size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">=</span> <span class="n">bit_size</span>
        <span class="c1"># Field value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span> 
                <span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">!s}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="si">!s}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="si">!s}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">!s}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">"</span>
                <span class="sa">f</span><span class="s2">"(index=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">!r}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"alignment=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="si">!r}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"bit_size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="si">!r}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"value=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">!r}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the :class:`Alignment` of the `Field` (read-only)."""</span>
        <span class="k">return</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_bit_offset</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bit_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the size of the `Field` in bits (read-only)."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">byte_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" :class:`Byteorder` used to decode and encode the :attr:`value`</span>
<span class="sd">        of the `Field`.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_byte_order</span>

    <span class="nd">@byte_order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">byte_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_order</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">get_member</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">byte_order</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ByteOrderValueError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">Byteorder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ByteOrderTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_byte_order</span> <span class="o">=</span> <span class="n">byte_order</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" :class:`Index` of the `Field`."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>

    <span class="nd">@index</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Field index</span>
        <span class="n">byte</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Invalid field index</span>
        <span class="k">if</span> <span class="n">byte</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">bit</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Field group size</span>
        <span class="n">group_size</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">+</span> <span class="n">bit</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
            <span class="n">group_size</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Bad aligned field group?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span> <span class="o">&lt;</span> <span class="n">group_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldGroupSizeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                      <span class="n">Alignment</span><span class="p">(</span><span class="n">group_size</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">))</span>

        <span class="c1"># No Bit field?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bit</span><span class="p">():</span>
            <span class="c1"># Set field alignment bit offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_bit_offset</span> <span class="o">=</span> <span class="n">bit</span>
        <span class="c1"># Bad aligned field group?</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span> <span class="o">!=</span> <span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldGroupOffsetError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                        <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">,</span>
                                                  <span class="n">bit</span><span class="p">))</span>

        <span class="c1"># Invalid field address</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldAddressError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

        <span class="c1"># Set field index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">byte</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">),</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">base</span><span class="p">),</span>
                            <span class="n">update</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Field` (read-only)."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">x</span>

<div class="viewcode-block" id="Field.is_bit"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_bit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_bit</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_bool"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_bool">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_bool</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_decimal"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_decimal">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_decimal</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_float"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_float">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_float</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_pointer"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_pointer">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_pointer</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_stream"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_stream">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_stream</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.is_string"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.is_string">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_string</span><span class="p">():</span>
        <span class="sd">""" Returns ``False``."""</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Field.unpack"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.unpack">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Unpacks the field :attr:`value` from the *buffer* at the given</span>
<span class="sd">        *index* in accordance with the decoding *byte order* for the</span>
<span class="sd">        de-serialization and the :attr:`byte_order` and :attr:`alignment`</span>
<span class="sd">        of the `Field`.</span>

<span class="sd">        The specific decoding :attr:`byte_order` of the `Field` overrules the</span>
<span class="sd">        decoding *byte order* for the de-serialization.</span>

<span class="sd">        Returns the deserialized field :attr:`value`.</span>

<span class="sd">        :param bytes buffer: byte stream.</span>
<span class="sd">        :param Index index: current read :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">        .. note:: This abstract method must be implemented by a derived class.</span>
<span class="sd">        """</span>
        <span class="c1"># Returns the deserialized field value.</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Field.pack"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.pack">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Packs the field :attr:`value` to the *buffer* at the given *index*</span>
<span class="sd">        in accordance with the encoding *byte order* for the serialization and</span>
<span class="sd">        the :attr:`byte_order` and :attr:`alignment` of the `Field`.</span>

<span class="sd">        The specific encoding :attr:`byte_order` of the `Field` overrules the</span>
<span class="sd">        encoding *byte order* for the serialization.</span>

<span class="sd">        Returns the :class:`bytes` for the serialized field :attr:`value`.</span>

<span class="sd">        :param bytearray buffer: byte stream.</span>
<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">        .. note:: This abstract method must be implemented by a derived class.</span>
<span class="sd">        """</span>
        <span class="c1"># Returns the byte serialized field value.</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Field.deserialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.deserialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" De-serializes the `Field` from the byte *buffer* starting at</span>
<span class="sd">        the begin of the *buffer* or with the given *index* by unpacking the</span>
<span class="sd">        bytes to the :attr:`value` of the `Field` in accordance with the</span>
<span class="sd">        decoding *byte order* for the de-serialization and the decoding</span>
<span class="sd">        :attr:`byte_order` of the `Field`.</span>

<span class="sd">        The specific decoding :attr:`byte_order` of the `Field` overrules the</span>
<span class="sd">        decoding *byte order* for the de-serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the `Field`.</span>

<span class="sd">        Optional the de-serialization of the referenced :attr:`~Pointer.data`</span>
<span class="sd">        object of a :class:`Pointer` field can be enabled.</span>

<span class="sd">        :param bytes buffer: byte stream.</span>
<span class="sd">        :param Index index: current read :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` a :class:`Pointer` field de-serialize</span>
<span class="sd">            its referenced :attr:`~Pointer.data` object as well</span>
<span class="sd">            (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the de-serialization of its</span>
<span class="sd">            referenced :attr:`~Pointer.data` object its own</span>
<span class="sd">            :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.serialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.serialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Serializes the `Field` to the byte *buffer* starting at the begin</span>
<span class="sd">        of the *buffer* or with the given *index* by packing the :attr:`value`</span>
<span class="sd">        of the `Field` to the byte *buffer* in accordance with the encoding</span>
<span class="sd">        *byte order* for the serialization and the encoding :attr:`byte_order`</span>
<span class="sd">        of the `Field`.</span>

<span class="sd">        The specific encoding :attr:`byte_order` of the `Field` overrules the</span>
<span class="sd">        encoding *byte order* for the serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the `Field`.</span>

<span class="sd">        Optional the serialization of the referenced :attr:`~Pointer.data` object</span>
<span class="sd">        of a :class:`Pointer` field can be enabled.</span>

<span class="sd">        :param bytearray buffer: byte stream.</span>
<span class="sd">        :param Index index: current write :class:`Index` of the *buffer*.</span>
<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` a :class:`Pointer` field serializes</span>
<span class="sd">            its referenced :attr:`~Pointer.data` object as well</span>
<span class="sd">            (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the encoding of its referenced</span>
<span class="sd">            :attr:`~Pointer.data` object its own :attr:`~Pointer.bytestream`.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">buffer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.index_field"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.index_field">[docs]</a>    <span class="k">def</span> <span class="nf">index_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">()):</span>
        <span class="sd">""" Indexes the `Field` with the given *index* und returns the</span>
<span class="sd">        :class:`Index` after the `Field`.</span>

<span class="sd">        :param Index index: start :class:`Index` for the `Field`.</span>
<span class="sd">        """</span>
        <span class="c1"># Set field index</span>
        <span class="c1"># Note: Updates the field alignment offset as well</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="c1"># Bit offset for the next field</span>
        <span class="n">byte</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">bit</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span>

        <span class="c1"># Field group size</span>
        <span class="n">group_size</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="c1"># End of field group?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span> <span class="o">==</span> <span class="n">group_size</span><span class="p">:</span>
            <span class="c1"># Bad aligned field group?</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FieldGroupSizeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
                                          <span class="n">Alignment</span><span class="p">(</span><span class="n">group_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Move byte index for the next field group</span>
                <span class="n">byte</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
                <span class="c1"># Reset bit offset for the next field group</span>
                <span class="n">bit</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Move address for the next field group</span>
                <span class="n">address</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="c1"># Index for the next field</span>
        <span class="k">return</span> <span class="n">Index</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Field.describe">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns the **metadata** of a `Field` as a :class:`dict`.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            metadata = {</span>
<span class="sd">                'address': self.index.address,</span>
<span class="sd">                'alignment': [self.alignment.byte_size, self.alignment.bit_offset],</span>
<span class="sd">                'class': self.name,</span>
<span class="sd">                'index': [self.index.byte, self.index.bit],</span>
<span class="sd">                'name': name if name else self.name,</span>
<span class="sd">                'order': self.byte_order.value,</span>
<span class="sd">                'size': self.bit_size,</span>
<span class="sd">                'type': Field.item_type.name,</span>
<span class="sd">                'value': self.value</span>
<span class="sd">            }</span>

<span class="sd">        :param str name: optional name for the `Field`.</span>
<span class="sd">            Fallback is the class name.</span>
<span class="sd">        :keyword bool nested: if ``True`` a :class:`Pointer` field lists its</span>
<span class="sd">            referenced :attr:`~Pointer.data` object fields as well</span>
<span class="sd">            (chained method call). Default is ``True``.</span>
<span class="sd">        """</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'address'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">'alignment'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">),</span>
            <span class="s1">'class'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">'order'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">'index'</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">],</span>
            <span class="s1">'name'</span><span class="p">:</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">'size'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="p">,</span>
            <span class="s1">'type'</span><span class="p">:</span> <span class="n">Field</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">'value'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Stream"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream">[docs]</a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">""" A `Stream` field is a :class:`Field` with a variable *size* and</span>
<span class="sd">    returns its field :attr:`value` as a hexadecimal string.</span>

<span class="sd">    Internally a `Stream` field uses a :class:`bytes` class to store the</span>
<span class="sd">    data of its field :attr:`value`.</span>

<span class="sd">    A `Stream` field is:</span>

<span class="sd">    *   *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">        of the `Stream` field.</span>
<span class="sd">    *   *sized*: ``len(self)`` returns the length of the `Stream` field.</span>
<span class="sd">    *   *indexable* ``self[index]`` returns the *byte* at the *index*</span>
<span class="sd">        of the `Stream` field.</span>
<span class="sd">    *   *iterable* ``iter(self)`` iterates over the bytes of the `Stream`</span>
<span class="sd">        field.</span>

<span class="sd">    :param int size: is the *size* of the `Stream` field in bytes.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; stream = Stream()</span>
<span class="sd">    &gt;&gt;&gt; stream.is_stream()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; stream.name</span>
<span class="sd">    'Stream'</span>
<span class="sd">    &gt;&gt;&gt; stream.alignment</span>
<span class="sd">    Alignment(byte_size=0, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; stream.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; stream.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; stream.index_field()</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; stream.bit_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(stream)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bool(stream)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; stream.value</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; bytes(stream)</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; stream.hex()</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; stream.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; stream.name</span>
<span class="sd">    'Stream10'</span>
<span class="sd">    &gt;&gt;&gt; stream.alignment</span>
<span class="sd">    Alignment(byte_size=10, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; stream.bit_size</span>
<span class="sd">    80</span>
<span class="sd">    &gt;&gt;&gt; stream.index_field()</span>
<span class="sd">    Index(byte=10, bit=0, address=10, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; stream.value</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; stream.value = '0102030405'</span>
<span class="sd">    &gt;&gt;&gt; stream.value</span>
<span class="sd">    '01020304050000000000'</span>
<span class="sd">    &gt;&gt;&gt; stream.resize(15)</span>
<span class="sd">    &gt;&gt;&gt; stream.value</span>
<span class="sd">    '010203040500000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; stream.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; stream.value = '0102030405060708090a0b0c'</span>
<span class="sd">    &gt;&gt;&gt; stream.value</span>
<span class="sd">    '0102030405060708090a'</span>
<span class="sd">    &gt;&gt;&gt; stream.hex()</span>
<span class="sd">    '0102030405060708090a'</span>
<span class="sd">    &gt;&gt;&gt; len(stream)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in stream]  # converts to int</span>
<span class="sd">    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="sd">    &gt;&gt;&gt; [hex(byte) for byte in stream]</span>
<span class="sd">    ['0x1', '0x2', '0x3', '0x4', '0x5', '0x6', '0x7', '0x8', '0x9', '0xa']</span>
<span class="sd">    &gt;&gt;&gt; stream[5]  # converts to int</span>
<span class="sd">    6</span>
<span class="sd">    &gt;&gt;&gt; 7 in stream</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in stream</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; stream[5:].hex()  # converts to bytes</span>
<span class="sd">    '060708090a'</span>
<span class="sd">    &gt;&gt;&gt; stream.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [10, 0],</span>
<span class="sd">     'class': 'Stream10',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'name': 'Stream10',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'size': 80,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '0102030405060708090a'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Stream field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Stream</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Field value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="c1"># Stream size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Stream` field (read-only)."""</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a lowercase hexadecimal encoded string."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_stream</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'hex'</span><span class="p">)</span>

<div class="viewcode-block" id="Stream.hex"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream.hex">[docs]</a>    <span class="k">def</span> <span class="nf">hex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns a string containing two hexadecimal digits for each byte</span>
<span class="sd">        in the :attr:`value` of the `Stream` field.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span></div>

<div class="viewcode-block" id="Stream.is_stream"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream.is_stream">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_stream</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'hex'</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">'hex'</span><span class="p">:</span>
                <span class="n">bytestream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">'ascii'</span><span class="p">:</span>
                <span class="n">bytestream</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FieldValueEncodingError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytearray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="n">bytestream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">bytestream</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="n">bytestream</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytestream</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bytestream</span>

<div class="viewcode-block" id="Stream.unpack"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream.unpack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="c1"># Content of the buffer mapped by the field</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">byte</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">bytestream</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">]</span>
        <span class="n">bytestream</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytestream</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bytestream</span></div>

<div class="viewcode-block" id="Stream.pack"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream.pack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span></div>

<div class="viewcode-block" id="Stream.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.Stream.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the `Stream` field by appending zero bytes or</span>
<span class="sd">        removing bytes from the end.</span>

<span class="sd">        :param int size: `Stream` size in number of bytes.</span>
<span class="sd">        """</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="o">-</span><span class="n">count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span> <span class="o">*</span> <span class="n">count</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span> <span class="o">=</span> <span class="n">size</span></div></div>


<div class="viewcode-block" id="String"><a class="viewcode-back" href="../../api/index.html#konfoo.String">[docs]</a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Stream</span><span class="p">):</span>
    <span class="sd">""" A `String` field is a :class:`Stream` field with a variable *size* and</span>
<span class="sd">    returns its field :attr:`value` as a zero-terminated ASCII string.</span>

<span class="sd">    A `String` field is:</span>

<span class="sd">    *   *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">        of the `String` field.</span>
<span class="sd">    *   *sized*: ``len(self)`` returns the length of the `String` field.</span>
<span class="sd">    *   *indexable* ``self[index]`` returns the *byte* at the *index*</span>
<span class="sd">        of the `String` field.</span>
<span class="sd">    *   *iterable* ``iter(self)`` iterates over the bytes of the `String`</span>
<span class="sd">        field.</span>

<span class="sd">    :param int size: is the *size* of the `String` field in bytes.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; string = String()</span>
<span class="sd">    &gt;&gt;&gt; string.is_stream()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; string.is_string()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; string.is_terminated()</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; string.name</span>
<span class="sd">    'String'</span>
<span class="sd">    &gt;&gt;&gt; string.alignment</span>
<span class="sd">    Alignment(byte_size=0, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; string.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; string.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; string.index_field()</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; string.bit_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(string)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bool(string)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; bytes(string)</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; string.hex()</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; string.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; string.name</span>
<span class="sd">    'String10'</span>
<span class="sd">    &gt;&gt;&gt; string.alignment</span>
<span class="sd">    Alignment(byte_size=10, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; string.bit_size</span>
<span class="sd">    80</span>
<span class="sd">    &gt;&gt;&gt; string.index_field()</span>
<span class="sd">    Index(byte=10, bit=0, address=10, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; string.value = 'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; string.resize(3)</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    'Kon'</span>
<span class="sd">    &gt;&gt;&gt; string.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    'Kon'</span>
<span class="sd">    &gt;&gt;&gt; string.value = 'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; string.value</span>
<span class="sd">    'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; string.hex()</span>
<span class="sd">    '4b6f6e466f6f20697320'</span>
<span class="sd">    &gt;&gt;&gt; len(string)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in string]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [chr(byte) for byte in string]  # converts to int</span>
<span class="sd">    ['K', 'o', 'n', 'F', 'o', 'o', ' ', 'i', 's', ' ']</span>
<span class="sd">    &gt;&gt;&gt; chr(string[5])  # converts to int -&gt; chr</span>
<span class="sd">    'o'</span>
<span class="sd">    &gt;&gt;&gt; ord(' ') in string</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in string</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; string[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; string[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; string.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [10, 0],</span>
<span class="sd">     'class': 'String10',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'name': 'String10',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'size': 80,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 'KonFoo is '}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a String field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">String</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as an ascii encoded string."""</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[:</span><span class="n">length</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'ascii'</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_stream</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'ascii'</span><span class="p">)</span>

<div class="viewcode-block" id="String.is_string"><a class="viewcode-back" href="../../api/index.html#konfoo.String.is_string">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_string</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="String.is_terminated"><a class="viewcode-back" href="../../api/index.html#konfoo.String.is_terminated">[docs]</a>    <span class="k">def</span> <span class="nf">is_terminated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns ``True`` if the `String` field is zero-terminated."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="Float"><a class="viewcode-back" href="../../api/index.html#konfoo.Float">[docs]</a><span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">""" A `Float` field is a :class:`Field` with a fix *size* of four bytes</span>
<span class="sd">    and returns its field :attr:`value` as a single precision float.</span>

<span class="sd">    Internally a `Float` field uses a :class:`float` class to store the</span>
<span class="sd">    data of its field :attr:`~Float.value`.</span>

<span class="sd">    A `Float` field extends the :attr:`~Field.metadata` of a :class:`Field`</span>
<span class="sd">    with a ``'max'`` and ``'min'`` key for its maximum and minimum possible</span>
<span class="sd">    field :attr:`.value`.</span>

<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Float` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; real = Float()</span>
<span class="sd">    &gt;&gt;&gt; real.is_float()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; real.name</span>
<span class="sd">    'Float32'</span>
<span class="sd">    &gt;&gt;&gt; real.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; real.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; real.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; real.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; real.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; real.min()</span>
<span class="sd">    -3.4028234663852886e+38</span>
<span class="sd">    &gt;&gt;&gt; real.max()</span>
<span class="sd">    3.4028234663852886e+38</span>
<span class="sd">    &gt;&gt;&gt; real.smallest()</span>
<span class="sd">    1.1754943508222875e-38</span>
<span class="sd">    &gt;&gt;&gt; real.epsilon()</span>
<span class="sd">    5.960464477539063e-08</span>
<span class="sd">    &gt;&gt;&gt; real.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(real)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(real)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(real)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bool(real)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; real.value = 0x10</span>
<span class="sd">    &gt;&gt;&gt; real.value</span>
<span class="sd">    16.0</span>
<span class="sd">    &gt;&gt;&gt; real.value = -3.4028234663852887e+38</span>
<span class="sd">    &gt;&gt;&gt; real.value</span>
<span class="sd">    -3.4028234663852886e+38</span>
<span class="sd">    &gt;&gt;&gt; real.value = 3.4028234663852887e+38</span>
<span class="sd">    &gt;&gt;&gt; real.value</span>
<span class="sd">    3.4028234663852886e+38</span>
<span class="sd">    &gt;&gt;&gt; real.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'Float32',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 3.4028234663852886e+38,</span>
<span class="sd">     'min': -3.4028234663852886e+38,</span>
<span class="sd">     'name': 'Float32',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 3.4028234663852886e+38}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Float field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Float</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Field value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">BYTEORDER</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a single precision floating point number."""</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="Float.is_float"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.is_float">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_float</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">epsilon</span><span class="p">():</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">24</span>

<div class="viewcode-block" id="Float.smallest"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.smallest">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">smallest</span><span class="p">():</span>
        <span class="sd">""" Returns the smallest normalized field *value* of the `Float` field."""</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">126</span></div>

<div class="viewcode-block" id="Float.max"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.max">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">max</span><span class="p">():</span>
        <span class="sd">""" Returns the maximal possible field *value* of the `Float` field."""</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">23</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">127</span></div>

<div class="viewcode-block" id="Float.min"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.min">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">min</span><span class="p">():</span>
        <span class="sd">""" Returns the minimal possible field *value* of the `Float` field."""</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">Float</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></div>

<div class="viewcode-block" id="Float.unpack"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.unpack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="c1"># Decoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Field byte order overrules!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span>

        <span class="c1"># Content of the buffer mapped by the field</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">]</span>

        <span class="c1"># Not enough content!</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">()</span>

        <span class="c1"># Unpack the content from the buffer</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">'&gt;f'</span><span class="p">,</span> <span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">'&lt;f'</span><span class="p">,</span> <span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Float.pack"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.pack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Encoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Field byte order overrules!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span>

        <span class="c1"># Pack the field value to bytes</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;f'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Float.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Float.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'max'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'min'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Double"><a class="viewcode-back" href="../../api/index.html#konfoo.Double">[docs]</a><span class="k">class</span> <span class="nc">Double</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">""" A `Double` field is a :class:`Field` with a fix *size* of eight bytes</span>
<span class="sd">    and returns its field :attr:`value` as a double precision float.</span>

<span class="sd">    Internally a `Double` field uses a :class:`float` class to store the</span>
<span class="sd">    data of its field :attr:`~Float.value`.</span>

<span class="sd">    A `Double` field extends the :attr:`~Field.metadata` of a :class:`Field`</span>
<span class="sd">    with a ``'max'`` and ``'min'`` key for its maximum and minimum possible</span>
<span class="sd">    field :attr:`.value`.</span>

<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Double` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; double = Double()</span>
<span class="sd">    &gt;&gt;&gt; double.is_float()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; double.name</span>
<span class="sd">    'Double64'</span>
<span class="sd">    &gt;&gt;&gt; double.alignment</span>
<span class="sd">    Alignment(byte_size=8, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; double.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; double.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; double.index_field()</span>
<span class="sd">    Index(byte=8, bit=0, address=8, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; double.bit_size</span>
<span class="sd">    64</span>
<span class="sd">    &gt;&gt;&gt; double.min()</span>
<span class="sd">    -1.7976931348623157e+308</span>
<span class="sd">    &gt;&gt;&gt; double.max()</span>
<span class="sd">    1.7976931348623157e+308</span>
<span class="sd">    &gt;&gt;&gt; double.smallest()</span>
<span class="sd">    2.2250738585072014e-308</span>
<span class="sd">    &gt;&gt;&gt; double.epsilon()</span>
<span class="sd">    1.1102230246251565e-16</span>
<span class="sd">    &gt;&gt;&gt; double.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(double)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(double)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(double)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bool(double)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; double.value = 0x10</span>
<span class="sd">    &gt;&gt;&gt; double.value</span>
<span class="sd">    16.0</span>
<span class="sd">    &gt;&gt;&gt; double.value = -1.7976931348623158e+308</span>
<span class="sd">    &gt;&gt;&gt; double.value</span>
<span class="sd">    -1.7976931348623157e+308</span>
<span class="sd">    &gt;&gt;&gt; double.value = 1.7976931348623158e+308</span>
<span class="sd">    &gt;&gt;&gt; double.value</span>
<span class="sd">    1.7976931348623157e+308</span>
<span class="sd">    &gt;&gt;&gt; double.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [8, 0],</span>
<span class="sd">     'class': 'Double64',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 1.7976931348623157e+308,</span>
<span class="sd">     'min': -1.7976931348623157e+308,</span>
<span class="sd">     'name': 'Double64',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'size': 64,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 1.7976931348623157e+308}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Double field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Double</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Field value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">BYTEORDER</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a double precision floating point number."""</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="Double.is_float"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.is_float">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_float</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">epsilon</span><span class="p">():</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">53</span>

<div class="viewcode-block" id="Double.smallest"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.smallest">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">smallest</span><span class="p">():</span>
        <span class="sd">""" Returns the smallest normalized field *value* of the `Double` field."""</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1022</span></div>

<div class="viewcode-block" id="Double.max"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.max">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">max</span><span class="p">():</span>
        <span class="sd">""" Returns the maximal possible field *value* of the `Double` field."""</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">52</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">1023</span></div>

<div class="viewcode-block" id="Double.min"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.min">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">min</span><span class="p">():</span>
        <span class="sd">""" Returns the minimal possible field *value* of the `Double` field."""</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">Double</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></div>

<div class="viewcode-block" id="Double.unpack"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.unpack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="c1"># Decoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Field byte order overrules!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span>

        <span class="c1"># Content of the buffer mapped by the field</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">]</span>

        <span class="c1"># Not enough content!</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">()</span>

        <span class="c1"># Unpack the content from the buffer</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">'&gt;d'</span><span class="p">,</span> <span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">'&lt;d'</span><span class="p">,</span> <span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Double.pack"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.pack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Bad placed field</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Encoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Field byte order overrules!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span>

        <span class="c1"># Pack the field value to bytes</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&gt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;d'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Double.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Double.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'max'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'min'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Decimal"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal">[docs]</a><span class="k">class</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">""" A `Decimal` field is a :class:`Field` with a variable *size*</span>
<span class="sd">    and returns its field :attr:`value` as a decimal number.</span>

<span class="sd">    Internally a `Decimal` field uses an :class:`int` class to store the</span>
<span class="sd">    data of its field :attr:`value`.</span>

<span class="sd">    A `Decimal` field extends the :attr:`~Field.metadata` of a :class:`Field`</span>
<span class="sd">    with a ``'max'`` and ``'min'`` key for its maximum and minimum possible</span>
<span class="sd">    field :attr:`value` and a ``'signed'`` key to mark the decimal number as</span>
<span class="sd">    signed or unsigned.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Decimal` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Decimal` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Decimal` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Decimal` field.</span>
<span class="sd">    :param bool signed: if ``True`` the `Decimal` field is signed otherwise</span>
<span class="sd">        unsigned.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Decimal` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; unsigned = Decimal(16)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; unsigned.name</span>
<span class="sd">    'Decimal16'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; unsigned.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unsigned.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bytes(unsigned)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(unsigned)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(unsigned)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(unsigned)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(unsigned)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(unsigned)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(unsigned)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unsigned.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.deserialize(bytes.fromhex('0080'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    32768</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    16384</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = -1</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = 65536</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; unsigned.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Decimal16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Decimal16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 65535}</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; signed = Decimal(16, signed=True)</span>
<span class="sd">    &gt;&gt;&gt; signed.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; signed.name</span>
<span class="sd">    'Decimal16'</span>
<span class="sd">    &gt;&gt;&gt; signed.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; signed.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; signed.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; signed.signed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; signed.min()</span>
<span class="sd">    -32768</span>
<span class="sd">    &gt;&gt;&gt; signed.max()</span>
<span class="sd">    32767</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bytes(signed)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(signed)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(signed)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(signed)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(signed)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(signed)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(signed)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; signed.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -16384</span>
<span class="sd">    &gt;&gt;&gt; signed.value = -0x4000</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -16384</span>
<span class="sd">    &gt;&gt;&gt; signed.value = -32769</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -32768</span>
<span class="sd">    &gt;&gt;&gt; signed.value = 32768</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    32767</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; signed.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff7f'</span>
<span class="sd">    &gt;&gt;&gt; signed.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Decimal16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 32767,</span>
<span class="sd">     'min': -32768,</span>
<span class="sd">     'name': 'Decimal16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': True,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 32767}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Decimal field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Decimal</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Field signed?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">signed</span><span class="p">)</span>
        <span class="c1"># Field alignment, Field bit size</span>
        <span class="k">if</span> <span class="n">align_to</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_alignment</span><span class="p">(</span><span class="n">group_size</span><span class="o">=</span><span class="n">align_to</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_bit_size</span><span class="p">(</span><span class="n">bit_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_bit_size</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Field value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_unsigned</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">BYTEORDER</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__index__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a decimal number."""</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">signed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns ``True`` if the `Decimal` field is signed."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signed</span>

    <span class="nd">@signed</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">signed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signed</span><span class="p">)</span>

<div class="viewcode-block" id="Decimal.is_decimal"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.is_decimal">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_decimal</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">decimal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">'ascii'</span><span class="p">:</span>
                <span class="n">decimal</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FieldValueEncodingError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span><span class="n">decimal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_set_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">bit_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">""" Sets the alignment of the ``Decimal`` field.</span>

<span class="sd">        :param int group_size: size of the aligned `Field` group in bytes,</span>
<span class="sd">            can be between ``1`` and ``8``.</span>
<span class="sd">        :param int bit_offset: bit offset of the `Decimal` field within the</span>
<span class="sd">            aligned `Field` group, can be between ``0`` and ``63``.</span>
<span class="sd">        :param bool auto_align: if ``True`` the `Decimal` field aligns itself</span>
<span class="sd">            to the next matching byte size according to the *size* of the</span>
<span class="sd">            `Decimal` field.</span>
<span class="sd">        """</span>
        <span class="c1"># Field alignment offset</span>
        <span class="n">field_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bit_offset</span><span class="p">)</span>

        <span class="c1"># Auto alignment</span>
        <span class="k">if</span> <span class="n">auto_align</span><span class="p">:</span>
            <span class="c1"># Field alignment size</span>
            <span class="n">field_size</span><span class="p">,</span> <span class="n">bit_offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">field_offset</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bit_offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">field_size</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">field_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">field_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># No auto alignment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Field alignment size</span>
            <span class="n">field_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">group_size</span><span class="p">)</span>

        <span class="c1"># Field alignment</span>
        <span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">field_size</span><span class="p">,</span> <span class="n">field_offset</span><span class="p">)</span>

        <span class="c1"># Invalid field alignment size</span>
        <span class="k">if</span> <span class="n">field_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FieldAlignmentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">alignment</span><span class="p">)</span>

        <span class="c1"># Invalid field alignment offset</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">field_offset</span> <span class="o">&lt;=</span> <span class="mi">63</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FieldAlignmentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">alignment</span><span class="p">)</span>

        <span class="c1"># Invalid field alignment</span>
        <span class="k">if</span> <span class="n">field_offset</span> <span class="o">&gt;=</span> <span class="n">field_size</span> <span class="o">*</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldAlignmentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">alignment</span><span class="p">)</span>

        <span class="c1"># Set field alignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_bit_offset</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span>

    <span class="k">def</span> <span class="nf">_set_bit_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">""" Sets the *size* of the `Decimal` field.</span>

<span class="sd">        :param int size: is the *size* of the `Decimal` field in bits,</span>
<span class="sd">            can be between ``1`` and ``64``.</span>
<span class="sd">        :param int step: is the minimal required step *size* for the `Decimal`</span>
<span class="sd">            field in bits.</span>
<span class="sd">        :param bool auto_align: if ``True`` the `Decimal` field aligns itself</span>
<span class="sd">            to the next matching byte size according to the *size* of the</span>
<span class="sd">            `Decimal` field.</span>
<span class="sd">        """</span>
        <span class="c1"># Field size</span>
        <span class="n">bit_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># Invalid field size</span>
        <span class="k">if</span> <span class="n">bit_size</span> <span class="o">%</span> <span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">bit_size</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FieldSizeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">)</span>

        <span class="c1"># Field group size</span>
        <span class="n">group_size</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c1"># Auto alignment</span>
        <span class="k">if</span> <span class="n">auto_align</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span> <span class="o">=</span> <span class="n">group_size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_align_to_byte_size</span> <span class="o">=</span> <span class="n">group_size</span>
        <span class="c1"># Invalid field alignment</span>
        <span class="k">elif</span> <span class="n">group_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldAlignmentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                      <span class="n">Alignment</span><span class="p">(</span><span class="n">group_size</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">))</span>
        <span class="c1"># Set field size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">=</span> <span class="n">bit_size</span>

    <span class="k">def</span> <span class="nf">_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">signed</span><span class="p">):</span>
        <span class="c1"># Sign conversion</span>
        <span class="k">if</span> <span class="n">minimum</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">maximum</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">signed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">|</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_mask</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_mask</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signed</span><span class="p">):</span>
        <span class="c1"># Maximal possible field value</span>
        <span class="k">if</span> <span class="n">signed</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signed</span><span class="p">):</span>
        <span class="c1"># Minimal possible field value</span>
        <span class="k">if</span> <span class="n">signed</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">bit_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">-</span> <span class="mi">1</span>

<div class="viewcode-block" id="Decimal.max"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the maximal possible field *value* of the `Decimal` field."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_signed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Decimal.min"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the minimal possible field *value* of the `Decimal` field."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_signed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Decimal.as_unsigned"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.as_unsigned">[docs]</a>    <span class="k">def</span> <span class="nf">as_unsigned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the field *value* of the `Decimal` field as an unsigned integer.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Decimal.as_signed"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.as_signed">[docs]</a>    <span class="k">def</span> <span class="nf">as_signed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the field *value* of the `Decimal` field as a signed integer."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Decimal.unpack"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.unpack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Content of the buffer mapped by the field group</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">]</span>

        <span class="c1"># Decoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Decode field value from the buffer</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">&gt;&gt;=</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span>
        <span class="n">value</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_mask</span><span class="p">()</span>

        <span class="c1"># Field alignment</span>
        <span class="n">field_size</span><span class="p">,</span> <span class="n">field_offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="c1"># Byte order conversion for field value necessary?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="c1"># No specific field byte order</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">byte_order</span><span class="p">:</span>
            <span class="c1"># Field byte order matches the</span>
            <span class="c1"># decoding byte order of the buffer</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">field_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Byte order not relevant for field's smaller than one byte</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">field_offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Bad sized field for independent byte order conversion</span>
            <span class="k">raise</span> <span class="n">FieldGroupByteOrderError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Byte order not relevant for field's with one byte</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Convert byte order of the field value</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">field_size</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Limit field value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">|=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_mask</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Decimal.pack"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.pack">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="c1"># Field value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">value</span> <span class="o">&amp;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_mask</span><span class="p">()</span>

        <span class="c1"># Encoding byte order of the buffer</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">get_byte_order</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Field alignment</span>
        <span class="n">field_size</span><span class="p">,</span> <span class="n">field_offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="c1"># Byte order conversion for field value necessary?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="c1"># No specific field byte order</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span> <span class="ow">is</span> <span class="n">byte_order</span><span class="p">:</span>
            <span class="c1"># Field byte order matches the</span>
            <span class="c1"># encoding byte order of the buffer</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">field_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Byte order not relevant for field's smaller than one byte</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">field_offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Bad sized field for independent byte order conversion</span>
            <span class="k">raise</span> <span class="n">FieldGroupByteOrderError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Byte order not relevant for field's with one byte</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Convert byte order of the field value</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">field_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                   <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Shift the field value to its field group offset</span>
        <span class="n">value</span> <span class="o">&lt;&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">bit</span>

        <span class="c1"># Content for the buffer mapped by the field group</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">byte</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
            <span class="c1"># Map the field value into the existing field group content of the buffer</span>
            <span class="n">view</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">|=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">],</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">view</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">,</span>
                                               <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Extent the buffer with the field group content and the field value</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Decimal.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Decimal.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'max'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'min'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'signed'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signed</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Bit"><a class="viewcode-back" href="../../api/index.html#konfoo.Bit">[docs]</a><span class="k">class</span> <span class="nc">Bit</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Bit` field is an unsigned :class:`Decimal` with a *size* of one bit</span>
<span class="sd">    and returns its field :attr:`value` as an unsigned integer number.</span>

<span class="sd">    :param int number: is the bit offset of the `Bit` field within the</span>
<span class="sd">        aligned bytes, can be between ``0`` and ``63``.</span>
<span class="sd">    :param int align_to: aligns the `Bit` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; bit = Bit(0)</span>
<span class="sd">    &gt;&gt;&gt; bit.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bit.is_bit()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bit.name</span>
<span class="sd">    'Bit'</span>
<span class="sd">    &gt;&gt;&gt; bit.alignment</span>
<span class="sd">    Alignment(byte_size=1, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; bit.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; bit.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bit.index_field()</span>
<span class="sd">    Index(byte=0, bit=1, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bit.bit_size</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; bit.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bit.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.max()</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bytes(bit)</span>
<span class="sd">    b'\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(bit)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(bit)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(bit)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(bit)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(bit)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(bit)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bit.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.deserialize(bytes.fromhex('01'))</span>
<span class="sd">    Index(byte=0, bit=1, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; bit.value = 0</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.value = False</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.value = True</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; bit.value = -1</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bit.value = 2</span>
<span class="sd">    &gt;&gt;&gt; bit.value</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; bit.serialize(bytestream)</span>
<span class="sd">    Index(byte=0, bit=1, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    '01'</span>
<span class="sd">    &gt;&gt;&gt; bit.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [1, 0],</span>
<span class="sd">     'class': 'Bit',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 1,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Bit',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 1,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 1}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Bit field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Bit</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">)</span>
        <span class="c1"># Field alignment</span>
        <span class="k">if</span> <span class="n">align_to</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_alignment</span><span class="p">(</span><span class="n">group_size</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span> <span class="n">bit_offset</span><span class="o">=</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_alignment</span><span class="p">(</span><span class="n">group_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bit_offset</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">auto_align</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Bit` field (read-only)."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

<div class="viewcode-block" id="Bit.is_bit"><a class="viewcode-back" href="../../api/index.html#konfoo.Bit.is_bit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_bit</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Byte"><a class="viewcode-back" href="../../api/index.html#konfoo.Byte">[docs]</a><span class="k">class</span> <span class="nc">Byte</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Byte` field is an unsigned :class:`Decimal` field with a *size* of</span>
<span class="sd">    one byte and returns its field :attr:`value` as a lowercase hexadecimal</span>
<span class="sd">    string prefixed with ``0x``.</span>

<span class="sd">    :param int align_to: aligns the `Byte` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Byte` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Byte` field.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; byte = Byte()</span>
<span class="sd">    &gt;&gt;&gt; byte.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; byte.name</span>
<span class="sd">    'Byte'</span>
<span class="sd">    &gt;&gt;&gt; byte.alignment</span>
<span class="sd">    Alignment(byte_size=1, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; byte.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; byte.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; byte.index_field()</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; byte.bit_size</span>
<span class="sd">    8</span>
<span class="sd">    &gt;&gt;&gt; byte.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; byte.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; byte.max()</span>
<span class="sd">    255</span>
<span class="sd">    &gt;&gt;&gt; byte.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(byte)</span>
<span class="sd">    b'\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(byte)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(byte)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(byte)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(byte)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(byte)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(byte)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; byte.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; byte.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; byte.deserialize(bytes.fromhex('20'))</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; byte.value</span>
<span class="sd">    '0x20'</span>
<span class="sd">    &gt;&gt;&gt; byte.value = 16</span>
<span class="sd">    &gt;&gt;&gt; byte.value</span>
<span class="sd">    '0x10'</span>
<span class="sd">    &gt;&gt;&gt; byte.value = -1</span>
<span class="sd">    &gt;&gt;&gt; byte.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; byte.value = 256</span>
<span class="sd">    &gt;&gt;&gt; byte.value</span>
<span class="sd">    '0xff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; byte.serialize(bytestream)</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff'</span>
<span class="sd">    &gt;&gt;&gt; byte.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [1, 0],</span>
<span class="sd">     'class': 'Byte',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 255,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Byte',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 8,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '0xff'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Byte field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Byte</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Byte` field (read-only)."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a lowercase hexadecimal string prefixed with ``0x``."""</span>
        <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Char"><a class="viewcode-back" href="../../api/index.html#konfoo.Char">[docs]</a><span class="k">class</span> <span class="nc">Char</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Char` field is an unsigned :class:`Decimal` field with a *size* of</span>
<span class="sd">    one byte and returns its field :attr:`value` as an unicode string character.</span>

<span class="sd">    :param int align_to: aligns the `Char` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Char` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Char` field.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; char = Char()</span>
<span class="sd">    &gt;&gt;&gt; char.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; char.name</span>
<span class="sd">    'Char'</span>
<span class="sd">    &gt;&gt;&gt; char.alignment</span>
<span class="sd">    Alignment(byte_size=1, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; char.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; char.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; char.index_field()</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; char.bit_size</span>
<span class="sd">    8</span>
<span class="sd">    &gt;&gt;&gt; char.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; char.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; char.max()</span>
<span class="sd">    255</span>
<span class="sd">    &gt;&gt;&gt; char.value</span>
<span class="sd">    '\\x00'</span>
<span class="sd">    &gt;&gt;&gt; bytes(char)</span>
<span class="sd">    b'\\x00'</span>
<span class="sd">    &gt;&gt;&gt; ord(char.value)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; int(char)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(char)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(char)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(char)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(char)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(char)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; char.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; char.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; char.deserialize(bytes.fromhex('41'))</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; char.value</span>
<span class="sd">    'A'</span>
<span class="sd">    &gt;&gt;&gt; char.value = 66</span>
<span class="sd">    &gt;&gt;&gt; char.value</span>
<span class="sd">    'B'</span>
<span class="sd">    &gt;&gt;&gt; char.value = 0x41</span>
<span class="sd">    &gt;&gt;&gt; char.value</span>
<span class="sd">    'A'</span>
<span class="sd">    &gt;&gt;&gt; char.value = 'F'</span>
<span class="sd">    &gt;&gt;&gt; char.value</span>
<span class="sd">    'F'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; char.serialize(bytestream)</span>
<span class="sd">    Index(byte=1, bit=0, address=1, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    '46'</span>
<span class="sd">    &gt;&gt;&gt; char.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [1, 0],</span>
<span class="sd">     'class': 'Char',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 255,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Char',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 8,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 'F'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Char field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Char</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Char` field (read-only)."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as an unicode string character."""</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'ascii'</span><span class="p">)</span></div>


<div class="viewcode-block" id="Signed"><a class="viewcode-back" href="../../api/index.html#konfoo.Signed">[docs]</a><span class="k">class</span> <span class="nc">Signed</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Signed` field is a signed :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its field :attr:`value` as a signed integer number.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Signed` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Signed` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Signed` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Signed` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Signed` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; signed = Signed(16)</span>
<span class="sd">    &gt;&gt;&gt; signed.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; signed.name</span>
<span class="sd">    'Signed16'</span>
<span class="sd">    &gt;&gt;&gt; signed.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; signed.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; signed.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; signed.signed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; signed.min()</span>
<span class="sd">    -32768</span>
<span class="sd">    &gt;&gt;&gt; signed.max()</span>
<span class="sd">    32767</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bytes(signed)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(signed)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(signed)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(signed)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(signed)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(signed)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(signed)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; signed.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; signed.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; signed.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -16384</span>
<span class="sd">    &gt;&gt;&gt; signed.value = -0x4000</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -16384</span>
<span class="sd">    &gt;&gt;&gt; signed.value = -32769</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    -32768</span>
<span class="sd">    &gt;&gt;&gt; signed.value = 32768</span>
<span class="sd">    &gt;&gt;&gt; signed.value</span>
<span class="sd">    32767</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; signed.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff7f'</span>
<span class="sd">    &gt;&gt;&gt; signed.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Signed16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 32767,</span>
<span class="sd">     'min': -32768,</span>
<span class="sd">     'name': 'Signed16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': True,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 32767}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Signed field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Signed</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span></div>


<div class="viewcode-block" id="Unsigned"><a class="viewcode-back" href="../../api/index.html#konfoo.Unsigned">[docs]</a><span class="k">class</span> <span class="nc">Unsigned</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Unsigned` field is an unsigned :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its field :attr:`value` as a lowercase hexadecimal string</span>
<span class="sd">    prefixed with ``0x``.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Unsigned` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Unsigned` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Unsigned` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Unsigned` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Unsigned` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; unsigned = Unsigned(16)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; unsigned.name</span>
<span class="sd">    'Unsigned16'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; unsigned.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unsigned.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(unsigned)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(unsigned)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(unsigned)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(unsigned)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(unsigned)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(unsigned)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(unsigned)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unsigned.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unsigned.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value = 0x10000</span>
<span class="sd">    &gt;&gt;&gt; unsigned.value</span>
<span class="sd">    '0xffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; unsigned.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; unsigned.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Unsigned16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Unsigned16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '0xffff'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of an Unsigned field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Unsigned</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a lowercase hexadecimal string prefixed with ``0x``."""</span>
        <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Bitset"><a class="viewcode-back" href="../../api/index.html#konfoo.Bitset">[docs]</a><span class="k">class</span> <span class="nc">Bitset</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Bitset` field is an unsigned :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its field :attr:`value` as a binary string prefixed with</span>
<span class="sd">    ``0b``.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Bitset` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Bitset` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Bitset` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Bitset` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Bitset` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; bitset = Bitset(16)</span>
<span class="sd">    &gt;&gt;&gt; bitset.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bitset.name</span>
<span class="sd">    'Bitset16'</span>
<span class="sd">    &gt;&gt;&gt; bitset.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; bitset.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; bitset.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bitset.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bitset.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; bitset.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bitset.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bitset.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; bitset.value</span>
<span class="sd">    '0b0000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; bytes(bitset)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(bitset)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(bitset)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(bitset)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(bitset)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(bitset)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(bitset)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bitset.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bitset.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bitset.deserialize(bytes.fromhex('f00f'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bitset.value</span>
<span class="sd">    '0b0000111111110000'</span>
<span class="sd">    &gt;&gt;&gt; bitset.value = 0b1111</span>
<span class="sd">    &gt;&gt;&gt; bitset.value</span>
<span class="sd">    '0b0000000000001111'</span>
<span class="sd">    &gt;&gt;&gt; bitset.value = -1</span>
<span class="sd">    &gt;&gt;&gt; bitset.value</span>
<span class="sd">    '0b0000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; bitset.value = 0x10000</span>
<span class="sd">    &gt;&gt;&gt; bitset.value</span>
<span class="sd">    '0b1111111111111111'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; bitset.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; bitset.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Bitset16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Bitset16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '0b1111111111111111'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Bitset field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Bitset</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a binary string prefixed with ``0b``."""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="si">:</span><span class="s2">#0</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">+</span> <span class="mi">2</span><span class="si">}</span><span class="s2">b</span><span class="si">}</span><span class="s2">"</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Bool"><a class="viewcode-back" href="../../api/index.html#konfoo.Bool">[docs]</a><span class="k">class</span> <span class="nc">Bool</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Bool` field is an unsigned :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its field :attr:`value` as a boolean value.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Bool` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Bool` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Bool` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Bool` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Bool` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; boolean = Bool(16)</span>
<span class="sd">    &gt;&gt;&gt; boolean.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; boolean.is_bool()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; boolean.name</span>
<span class="sd">    'Bool16'</span>
<span class="sd">    &gt;&gt;&gt; boolean.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; boolean.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; boolean.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; boolean.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; boolean.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; boolean.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; boolean.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; boolean.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; boolean.value</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bytes(boolean)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(boolean)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(boolean)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(boolean)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(boolean)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(boolean)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(boolean)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; boolean.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; boolean.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; boolean.deserialize(bytes.fromhex('0f00'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; boolean.value</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; boolean.value = False</span>
<span class="sd">    &gt;&gt;&gt; boolean.value</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; boolean.value = -1</span>
<span class="sd">    &gt;&gt;&gt; boolean.value</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; boolean.value = 0x10000</span>
<span class="sd">    &gt;&gt;&gt; boolean.value</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; boolean.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; boolean.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Bool16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Bool16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': True}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Bool field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a boolean value, ``True`` or ``False``."""</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="Bool.is_bool"><a class="viewcode-back" href="../../api/index.html#konfoo.Bool.is_bool">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_bool</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Enum"><a class="viewcode-back" href="../../api/index.html#konfoo.Enum">[docs]</a><span class="k">class</span> <span class="nc">Enum</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Enum` field is an unsigned :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its field :attr:`value` as an unsigned integer number.</span>

<span class="sd">    If an :class:`Enumeration` is available and a member matches the integer</span>
<span class="sd">    number then the member name string is returned otherwise the integer number</span>
<span class="sd">    is returned.</span>

<span class="sd">    :param int bit_size: is the *size* of the `Enum` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Enum` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Enum` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Enum` field.</span>
<span class="sd">    :param enumeration: :class:`Enumeration` definition of the `Enum` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Enum` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; enum = Enum(16, enumeration=ItemClass)</span>
<span class="sd">    &gt;&gt;&gt; enum.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; enum.name</span>
<span class="sd">    'Enum16'</span>
<span class="sd">    &gt;&gt;&gt; enum.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; enum.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; enum.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; enum.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; enum.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; enum.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bytes(enum)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; enum.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; enum.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; int(enum)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(enum)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(enum)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(enum)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(enum)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(enum)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; enum.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; enum.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; enum.deserialize(bytes.fromhex('2800'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    'Decimal'</span>
<span class="sd">    &gt;&gt;&gt; enum.value = 48</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    'Enum'</span>
<span class="sd">    &gt;&gt;&gt; enum.value = 'Enum'</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    'Enum'</span>
<span class="sd">    &gt;&gt;&gt; enum.value = 40</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    'Decimal'</span>
<span class="sd">    &gt;&gt;&gt; enum.value = -1</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; enum.value = 65536</span>
<span class="sd">    &gt;&gt;&gt; enum.value</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; enum.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; enum.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Enum16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Enum16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 65535}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of an Enum field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Enum</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enumeration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Field enumeration class</span>
        <span class="k">if</span> <span class="n">enumeration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="n">Enumeration</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enum</span> <span class="o">=</span> <span class="n">enumeration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EnumTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enumeration</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as an enum name string.</span>
<span class="sd">        Fall back is an unsigned integer number.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enum</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_enum</span><span class="p">,</span> <span class="n">Enumeration</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enum</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">decimal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enum</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_enum</span><span class="p">,</span> <span class="n">Enumeration</span><span class="p">):</span>
                    <span class="n">decimal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_enum</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">decimal</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">FieldValueError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FieldValueError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimal</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scaled"><a class="viewcode-back" href="../../api/index.html#konfoo.Scaled">[docs]</a><span class="k">class</span> <span class="nc">Scaled</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Scaled` field is a signed :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its scaled field :attr:`value` as a floating point</span>
<span class="sd">    number.</span>

<span class="sd">    The scaled field *value* is:</span>

<span class="sd">        ``(unscaled field value / scaling base) * scaling factor``</span>

<span class="sd">    The unscaled field *value* is:</span>

<span class="sd">        ``(scaled field value / scaling factor) * scaling base``</span>

<span class="sd">    The scaling base is:</span>

<span class="sd">        ``2 ** (field size - 1) / 2``</span>

<span class="sd">    A `Scaled` field extends the :attr:`~Field.metadata` of a :class:`Decimal`</span>
<span class="sd">    with a ``'scale'`` key for its scaling factor.</span>

<span class="sd">    :param float scale: scaling factor of the `Scaled` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Scaled` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Scaled` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Scaled` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Scaled` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Scaled` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; scaled = Scaled(100, 16)</span>
<span class="sd">    &gt;&gt;&gt; scaled.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; scaled.name</span>
<span class="sd">    'Scaled16'</span>
<span class="sd">    &gt;&gt;&gt; scaled.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; scaled.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; scaled.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; scaled.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; scaled.scale</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; scaled.scaling_base()</span>
<span class="sd">    16384.0</span>
<span class="sd">    &gt;&gt;&gt; scaled.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; scaled.signed</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; scaled.min()</span>
<span class="sd">    -32768</span>
<span class="sd">    &gt;&gt;&gt; scaled.max()</span>
<span class="sd">    32767</span>
<span class="sd">    &gt;&gt;&gt; scaled.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(scaled)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(scaled)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(scaled)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(scaled)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(scaled)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(scaled)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(scaled)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; scaled.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; scaled.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; scaled.deserialize(bytes.fromhex('0040'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; scaled.value</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; scaled.value = -100</span>
<span class="sd">    &gt;&gt;&gt; scaled.value</span>
<span class="sd">    -100.0</span>
<span class="sd">    &gt;&gt;&gt; scaled.value = -200.001</span>
<span class="sd">    &gt;&gt;&gt; scaled.value</span>
<span class="sd">    -200.0</span>
<span class="sd">    &gt;&gt;&gt; scaled.value = 200</span>
<span class="sd">    &gt;&gt;&gt; scaled.value</span>
<span class="sd">    199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; scaled.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff7f'</span>
<span class="sd">    &gt;&gt;&gt; scaled.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Scaled16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 32767,</span>
<span class="sd">     'min': -32768,</span>
<span class="sd">     'name': 'Scaled16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'scale': 100.0,</span>
<span class="sd">     'signed': True,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 199.993896484375}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Scaled field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Scaled</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Field scaling factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a floating point number."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_scaled</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling_base</span><span class="p">())</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

    <span class="k">def</span> <span class="nf">to_scaled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling_base</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Scaling factor of the `Scaled` field."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>

    <span class="nd">@scale</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Scaled.scaling_base"><a class="viewcode-back" href="../../api/index.html#konfoo.Scaled.scaling_base">[docs]</a>    <span class="k">def</span> <span class="nf">scaling_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the scaling base of the `Scaled` field."""</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="Scaled.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Scaled.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'scale'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Fraction"><a class="viewcode-back" href="../../api/index.html#konfoo.Fraction">[docs]</a><span class="k">class</span> <span class="nc">Fraction</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Fraction` field is an unsigned :class:`Decimal` field with a variable</span>
<span class="sd">    *size* and returns its fractional field :attr:`value` as a floating point</span>
<span class="sd">    number.</span>

<span class="sd">    A fractional number is bitwise encoded and has up to three bit parts for</span>
<span class="sd">    this task.</span>

<span class="sd">    The first part are the bits for the fraction part of a fractional number.</span>
<span class="sd">    The number of bits for the fraction part is derived from the *bit size*</span>
<span class="sd">    of the field and the required bits for the other two parts.</span>
<span class="sd">    The fraction part is always smaller than one.</span>

<span class="sd">        ``fraction part = (2**bits - 1) / (2**bits)``</span>

<span class="sd">    The second part are the *bits* for the *integer* part of a fractional</span>
<span class="sd">    number.</span>

<span class="sd">        ``integer part = (2**bits - 1)``</span>

<span class="sd">    The third part is the bit for the sign of a *signed* fractional</span>
<span class="sd">    number. Only a *signed* fractional number posses this bit.</span>

<span class="sd">        ``sign part = {'0': '+', '1': '-'}``</span>

<span class="sd">    A fractional number is multiplied by hundred.</span>

<span class="sd">    :param int bits_integer: number of bits for the integer part of the</span>
<span class="sd">        fraction number, can be between *1* and the *size* of the</span>
<span class="sd">        `Fraction` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Fraction` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Fraction` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Fraction` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Fraction` field.</span>
<span class="sd">    :param bool signed: if ``True`` the `Fraction` field is signed otherwise</span>
<span class="sd">        unsigned.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Fraction` field</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; unipolar = Fraction(2, 16)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; unipolar.name</span>
<span class="sd">    'Fraction2.16'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; unipolar.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unipolar.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(unipolar)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(unipolar)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(unipolar)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(unipolar)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(unipolar)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(unipolar)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(unipolar)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.deserialize(bytes.fromhex('0080'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    200.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = 100</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_float(0x4000)</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = -1</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = 400</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    399.993896484375</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_float(0xffff)</span>
<span class="sd">    399.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; unipolar.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Fraction2.16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Fraction2.16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 399.993896484375}</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; bipolar = Fraction(2, 16, 2, True)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bipolar.name</span>
<span class="sd">    'Fraction2.16'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; bipolar.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bipolar.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(bipolar)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(bipolar)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(bipolar)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(bipolar)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(bipolar)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(bipolar)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(bipolar)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.deserialize(bytes.fromhex('0040'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = -100</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    -100.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0xc000)</span>
<span class="sd">    -100.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0x8000)</span>
<span class="sd">    -0.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = -200</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    -199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0xffff)</span>
<span class="sd">    -199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = 200</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0x7fff)</span>
<span class="sd">    199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; bipolar.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff7f'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Fraction2.16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Fraction2.16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': True,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 199.993896484375}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Fraction field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Fraction</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits_integer</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
        <span class="c1"># Number of bits of the integer part of the fraction number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bits_integer</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bits_integer</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span><span class="p">)</span>
        <span class="c1"># Fraction number signed?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_signed_fraction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_signed_fraction</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">signed</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the type name of the `Fraction` field (read-only)."""</span>
        <span class="k">return</span> <span class="s2">"</span><span class="si">{0}{1}</span><span class="s2">.</span><span class="si">{2}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_bits_integer</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a floating point number."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_fraction</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">bits_fraction</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bits_integer</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">bits_fraction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">bits_fraction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signed_fraction</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mask</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">bits_fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">bits_fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">integer</span> <span class="o">+</span> <span class="n">fraction</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span>

    <span class="k">def</span> <span class="nf">to_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="n">bits_fraction</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bits_integer</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signed_fraction</span><span class="p">:</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">normalized</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">bits_fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">normalized</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">normalized</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">bits_fraction</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalized</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">decimal</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">integer</span> <span class="o">|</span> <span class="n">fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">decimal</span> <span class="o">|=</span> <span class="n">mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">bits_fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">normalized</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">normalized</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">bits_fraction</span><span class="p">)</span>
            <span class="n">decimal</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">integer</span> <span class="o">|</span> <span class="n">fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span>

<div class="viewcode-block" id="Fraction.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Fraction.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'signed'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signed_fraction</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Bipolar"><a class="viewcode-back" href="../../api/index.html#konfoo.Bipolar">[docs]</a><span class="k">class</span> <span class="nc">Bipolar</span><span class="p">(</span><span class="n">Fraction</span><span class="p">):</span>
    <span class="sd">""" A `Bipolar` field is a signed :class:`Fraction` field with a variable</span>
<span class="sd">    *size* and returns its fractional field :attr:`value` as a floating point</span>
<span class="sd">    number.</span>

<span class="sd">    :param int bits_integer: number of bits for the integer part of the</span>
<span class="sd">        fraction number, can be between *1* and the *size* of the</span>
<span class="sd">        `Bipolar` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Bipolar` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Bipolar` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Bipolar` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Bipolar` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Bipolar` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; bipolar = Bipolar(2, 16)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; bipolar.name</span>
<span class="sd">    'Bipolar2.16'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bipolar.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; bipolar.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bipolar.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(bipolar)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(bipolar)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(bipolar)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(bipolar)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(bipolar)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(bipolar)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(bipolar)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = -100</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    -100.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0xc000)</span>
<span class="sd">    -100.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0x8000)</span>
<span class="sd">    -0.0</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = -200</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    -199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0xffff)</span>
<span class="sd">    -199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value = 200</span>
<span class="sd">    &gt;&gt;&gt; bipolar.value</span>
<span class="sd">    199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bipolar.as_float(0x7fff)</span>
<span class="sd">    199.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; bipolar.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ff7f'</span>
<span class="sd">    &gt;&gt;&gt; bipolar.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Bipolar2.16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Bipolar2.16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': True,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 199.993896484375}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Bipolar field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Bipolar</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits_integer</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bits_integer</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span></div>


<div class="viewcode-block" id="Unipolar"><a class="viewcode-back" href="../../api/index.html#konfoo.Unipolar">[docs]</a><span class="k">class</span> <span class="nc">Unipolar</span><span class="p">(</span><span class="n">Fraction</span><span class="p">):</span>
    <span class="sd">""" An `Unipolar` field is an unsigned :class:`Fraction` field with a variable</span>
<span class="sd">    *size* and returns its fractional field :attr:`value` as a floating point</span>
<span class="sd">    number.</span>

<span class="sd">    :param int bits_integer: number of bits for the integer part of the</span>
<span class="sd">        fraction number, can be between *1* and the *size* of the</span>
<span class="sd">        `Unipolar` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Unipolar` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Unipolar` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Unipolar` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Unipolar` field.</span>
<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Unipolar` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; unipolar = Unipolar(2, 16)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; unipolar.name</span>
<span class="sd">    'Unipolar2.16'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.alignment</span>
<span class="sd">    Alignment(byte_size=2, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.index_field()</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.bit_size</span>
<span class="sd">    16</span>
<span class="sd">    &gt;&gt;&gt; unipolar.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unipolar.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.max()</span>
<span class="sd">    65535</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; bytes(unipolar)</span>
<span class="sd">    b'\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(unipolar)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(unipolar)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(unipolar)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(unipolar)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(unipolar)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(unipolar)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.deserialize(bytes.fromhex('0080'))</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    200.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = 100</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_float(0x4000)</span>
<span class="sd">    100.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = -1</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value = 400</span>
<span class="sd">    &gt;&gt;&gt; unipolar.value</span>
<span class="sd">    399.993896484375</span>
<span class="sd">    &gt;&gt;&gt; unipolar.as_float(0xffff)</span>
<span class="sd">    399.993896484375</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; unipolar.serialize(bytestream)</span>
<span class="sd">    Index(byte=2, bit=0, address=2, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffff'</span>
<span class="sd">    &gt;&gt;&gt; unipolar.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [2, 0],</span>
<span class="sd">     'class': 'Unipolar2.16',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 65535,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Unipolar2.16',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 16,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': 399.993896484375}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Unipolar field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Unipolar</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits_integer</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bits_integer</span><span class="p">,</span> <span class="n">bit_size</span><span class="p">,</span> <span class="n">align_to</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span></div>


<div class="viewcode-block" id="Datetime"><a class="viewcode-back" href="../../api/index.html#konfoo.Datetime">[docs]</a><span class="k">class</span> <span class="nc">Datetime</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" A `Datetime` field is an unsigned :class:`Decimal` field with a fix</span>
<span class="sd">    *size* of four bytes and returns its field :attr:`value` as an UTC datetime</span>
<span class="sd">    string in the ISO format ``YYYY-mm-dd HH:MM:SS``.</span>

<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Datetime` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; datetime = Datetime()</span>
<span class="sd">    &gt;&gt;&gt; datetime.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; datetime.name</span>
<span class="sd">    'Datetime32'</span>
<span class="sd">    &gt;&gt;&gt; datetime.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; datetime.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; datetime.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; datetime.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; datetime.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; datetime.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; datetime.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; datetime.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; datetime.value</span>
<span class="sd">    '1970-01-01 00:00:00'</span>
<span class="sd">    &gt;&gt;&gt; bytes(datetime)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(datetime)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(datetime)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(datetime)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(datetime)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(datetime)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(datetime)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; datetime.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; datetime.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; datetime.deserialize(bytes.fromhex('ffffffff'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; datetime.value</span>
<span class="sd">    '2106-02-07 06:28:15'</span>
<span class="sd">    &gt;&gt;&gt; datetime.value = '1969-12-31 23:59:59'</span>
<span class="sd">    &gt;&gt;&gt; datetime.value</span>
<span class="sd">    '1970-01-01 00:00:00'</span>
<span class="sd">    &gt;&gt;&gt; datetime.value = '2106-02-07 06:28:16'</span>
<span class="sd">    &gt;&gt;&gt; datetime.value</span>
<span class="sd">    '2106-02-07 06:28:15'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; datetime.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; datetime.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'Datetime32',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Datetime32',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '2106-02-07 06:28:15'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Datetime field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Datetime</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as an UTC datetime string in the ISO format</span>
<span class="sd">        ``YYYY-mm-dd HH:MM:SS``"""</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">))</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">decimal</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span></div>


<div class="viewcode-block" id="IPv4Address"><a class="viewcode-back" href="../../api/index.html#konfoo.IPv4Address">[docs]</a><span class="k">class</span> <span class="nc">IPv4Address</span><span class="p">(</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="sd">""" An `IPv4Address` field is an unsigned :class:`Decimal` field with a fix</span>
<span class="sd">    *size* of four bytes and returns its field :attr:`value` as an IPv4 address</span>
<span class="sd">    formatted string.</span>

<span class="sd">    :param byte_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `IPv4Address` field.</span>
<span class="sd">    :type byte_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; ipv4 = IPv4Address()</span>
<span class="sd">    &gt;&gt;&gt; ipv4.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; ipv4.name</span>
<span class="sd">    'Ipaddress32'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; ipv4.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; ipv4.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; ipv4.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; ipv4.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; ipv4.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; ipv4.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value</span>
<span class="sd">    '0.0.0.0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(ipv4)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(ipv4)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(ipv4)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(ipv4)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(ipv4)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(ipv4)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(ipv4)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; ipv4.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; ipv4.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; ipv4.deserialize(bytes.fromhex('ffffffff'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value</span>
<span class="sd">    '255.255.255.255'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value = '192.168.0.0'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value</span>
<span class="sd">    '192.168.0.0'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value = '255.255.255.255'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.value</span>
<span class="sd">    '255.255.255.255'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; ipv4.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; ipv4.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'Ipaddress32',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Ipaddress32',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Field',</span>
<span class="sd">     'value': '255.255.255.255'}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a IPAddress field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">IPAddress</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as an IPv4 address formatted string."""</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">))</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="Pointer"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer">[docs]</a><span class="k">class</span> <span class="nc">Pointer</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
    <span class="sd">""" A `Pointer` field is an unsigned :class:`Decimal` field with a *size* of</span>
<span class="sd">    four bytes and returns its field :attr:`value` as a hexadecimal string.</span>

<span class="sd">    A `Pointer` field refers absolutely to a :attr:`data` object of a data</span>
<span class="sd">    :class:`Provider`.</span>

<span class="sd">    The `Pointer` class extends the :class:`Decimal` field with the</span>
<span class="sd">    :class:`Container` interface for its referenced :attr:`data` object.</span>

<span class="sd">    A `Pointer` field has additional features to **read**, **write**,</span>
<span class="sd">    **deserialize**, **serialize** and **view** binary data:</span>

<span class="sd">    * **Deserialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the :attr:`data` object referenced by the `Pointer` field from</span>
<span class="sd">      a byte stream via :meth:`deserialize_data`.</span>
<span class="sd">    * **Serialize** the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">      in the :attr:`data` object referenced by the `Pointer` field to a</span>
<span class="sd">      byte stream via :meth:`serialize_data`.</span>
<span class="sd">    * **Indexes** each :class:`Field` in the :attr:`data` object</span>
<span class="sd">      referenced by the `Pointer` field via :meth:`index_data`.</span>
<span class="sd">    * **Read** from a :class:`Provider` the necessary bytes for the :attr:`data`</span>
<span class="sd">      object referenced by the `Pointer` field via :meth:`read_from`.</span>
<span class="sd">    * **Write** to a :class:`Provider` the necessary bytes for the</span>
<span class="sd">      :attr:`data` object referenced by the `Pointer` field</span>
<span class="sd">      via :meth:`write_to`.</span>
<span class="sd">    * Get the accumulated **size** of all fields in the :attr:`data` object</span>
<span class="sd">      referenced by the `Pointer` field via :attr:`data_size`.</span>
<span class="sd">    * Indexes the `Pointer` field and each :class:`Field` in the :attr:`data`</span>
<span class="sd">      object referenced by the `Pointer` field via :meth:`index_fields`.</span>
<span class="sd">    * View the selected *attributes* of the `Pointer` field and for each</span>
<span class="sd">      :class:`Field` in the :attr:`data` object referenced by the `Pointer`</span>
<span class="sd">      field via :meth:`view_fields`.</span>
<span class="sd">    * List the **path** to the field and the field **item** for the `Pointer` field</span>
<span class="sd">      and for each :class:`Field` in the :attr:`data` object referenced by the</span>
<span class="sd">      `Pointer` field as a flatten list via :meth:`field_items`.</span>
<span class="sd">    * Get the **metadata** of the `Pointer` field via :meth:`describe`.</span>

<span class="sd">    :param template: template for the :attr:`data` object referenced by the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `Pointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = Pointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.initialize_fields({'value': 0x8000})</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x8000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=0, bit=0, address=4294967295, base_address=4294967295, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'Pointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'Pointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff'}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': None}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": null}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      Pointer(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">              alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">              bit_size=32,</span>
<span class="sd">              value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('Pointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'Pointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>
    <span class="c1"># Item type of a Pointer field.</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="n">ItemClass</span><span class="o">.</span><span class="n">Pointer</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">byte_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>
        <span class="c1"># Field value</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">address</span>
        <span class="c1"># Data object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">template</span>
        <span class="c1"># Data objects bytestream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="c1"># Data objects byte order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_byte_order</span> <span class="o">=</span> <span class="n">data_order</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the *data source* address of the :attr:`data` object</span>
<span class="sd">        referenced by the `Pointer` field (read-only).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the *data source* base address of the :attr:`data` object</span>
<span class="sd">        referenced by the `Pointer` field (read-only).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bytestream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Byte stream of the `Pointer` field for the referenced :attr:`data`</span>
<span class="sd">        object. Returned as a lowercase hexadecimal encoded string.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

    <span class="nd">@bytestream</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bytestream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytearray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FieldTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" `Data` object referenced by the `Pointer` field."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">is_any</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">'data'</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_byte_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" :class:`Byteorder` used to deserialize and serialize the :attr:`data`</span>
<span class="sd">        object referenced by the `Pointer` field.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_byte_order</span>

    <span class="nd">@data_byte_order</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_byte_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">get_member</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">byte_order</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ByteOrderValueError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">Byteorder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ByteOrderTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FieldByteOrderError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_byte_order</span> <span class="o">=</span> <span class="n">byte_order</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the size of the :attr:`data` object in bytes (read-only)."""</span>
        <span class="c1"># Container</span>
        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="n">byte_length</span><span class="p">,</span> <span class="n">bit_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">container_size</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">byte_length</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bit_length</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Field value as a lowercase hexadecimal string prefixed with ``0x``."""</span>
        <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="Pointer.is_pointer"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.is_pointer">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_pointer</span><span class="p">():</span>
        <span class="sd">""" Returns ``True``."""</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Pointer.is_null"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.is_null">[docs]</a>    <span class="k">def</span> <span class="nf">is_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns ``True`` if the `Pointer` field points to zero."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">==</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Pointer.deserialize_data"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.deserialize_data">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">byte_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">""" De-serializes the :attr:`data` object referenced by the `Pointer`</span>
<span class="sd">        field from the byte *buffer* by mapping the bytes to the</span>
<span class="sd">        :attr:`~Field.value` for each :class:`Field` in the :attr:`data` object</span>
<span class="sd">        in accordance with the decoding *byte order* for the de-serialization</span>
<span class="sd">        and the decoding :attr:`byte_order` of each :class:`Field` in the</span>
<span class="sd">        :attr:`data` object.</span>

<span class="sd">        A specific decoding :attr:`byte_order` of a :class:`Field` in</span>
<span class="sd">        the :attr:`data` object overrules the decoding *byte order* for the</span>
<span class="sd">        de-serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the last de-serialized</span>
<span class="sd">        :class:`Field` in the :attr:`data` object.</span>

<span class="sd">        :param bytes buffer: byte stream. Default is the internal</span>
<span class="sd">            :attr:`bytestream` of the `Pointer` field.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">            Default is the :attr:`data_byte_order` of the `Pointer` field.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        """</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'little'</span><span class="p">,</span> <span class="s1">'big'</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">):</span>
                <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_byte_order</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">buffer</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span><span class="p">,</span>
                                           <span class="n">index</span><span class="p">,</span>
                                           <span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Pointer.serialize_data"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.serialize_data">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">""" Serializes the :attr:`data` object referenced by the `Pointer` field</span>
<span class="sd">        to bytes by mapping the :attr:`~Field.value` for each :class:`Field`</span>
<span class="sd">        in the :attr:`data` object to a number of bytes in accordance with the</span>
<span class="sd">        encoding *byte order* for the serialization and the encoding</span>
<span class="sd">        :attr:`byte_order` of each :class:`Field` in the :attr:`data` object.</span>

<span class="sd">        A specific encoding :attr:`~Field.byte_order` of a :class:`Field` in</span>
<span class="sd">        the :attr:`data` object overrules the encoding *byte order* for the</span>
<span class="sd">        serialization.</span>

<span class="sd">        Returns a number of bytes for the serialized :attr:`data` object</span>
<span class="sd">        referenced by the `Pointer` field.</span>

<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">            Default is the :attr:`data_byte_order` of the `Pointer` field.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'little'</span><span class="p">,</span> <span class="s1">'big'</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">little</span><span class="p">,</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">):</span>
            <span class="n">byte_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_byte_order</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
                             <span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                   <span class="kc">False</span><span class="p">),</span>
                             <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pointer.index_data"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.index_data">[docs]</a>    <span class="k">def</span> <span class="nf">index_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Indexes each :class:`Field` in the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">        """</span>
        <span class="c1"># Start index for the Data Object</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Container</span>
        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_fields</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Pointer</span>
        <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_data</span><span class="p">()</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pointer.read_from"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.read_from">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">null_allowed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Reads from the data :class:`Provider` the necessary number of bytes</span>
<span class="sd">        for the :attr:`data` object referenced by the `Pointer` field.</span>

<span class="sd">        A `Pointer` field stores the binary data read from the data</span>
<span class="sd">        :class:`Provider` in its :attr:`bytestream`.</span>

<span class="sd">        :param Provider provider: data :class:`Provider`.</span>
<span class="sd">        :param bool null_allowed: if ``True`` read access of address zero (Null)</span>
<span class="sd">            is allowed.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`data` object of the `Pointer` field reads their referenced</span>
<span class="sd">            :attr:`~Pointer.data` object fields as well (chained method call).</span>
<span class="sd">            Each `Pointer` field stores the bytes for its referenced</span>
<span class="sd">            :attr:`data` object in its :attr:`bytestream`.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">is_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">null_allowed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bytestream</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_size</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_data</span><span class="p">()</span>
                    <span class="c1"># Incomplete data object</span>
                    <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">length</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span>
                        <span class="k">raise</span> <span class="n">ContainerLengthError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="o">.</span><span class="n">update</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bytestream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProviderTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pointer.patch"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">):</span>
        <span class="sd">""" Returns a memory :class:`Patch` for the given *item* that shall be</span>
<span class="sd">        patched in the `data source`.</span>

<span class="sd">        :param item: item to patch.</span>
<span class="sd">        :param byte_order: encoding :class:`Byteorder` for the item.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        """</span>
        <span class="c1"># Re-index the data object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">container_size</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">length</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Incomplete container</span>
                <span class="k">raise</span> <span class="n">ContainerLengthError</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

            <span class="n">field</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">first_field</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Empty container?</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">index</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Bad placed container</span>
                <span class="k">raise</span> <span class="n">FieldIndexError</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

            <span class="c1"># Create a dummy byte array filled with zero bytes.</span>
            <span class="c1"># The dummy byte array is necessary because the length of</span>
            <span class="c1"># the buffer must correlate to the field indexes of the</span>
            <span class="c1"># appending fields.</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span> <span class="o">*</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">)</span>

            <span class="c1"># Append to the buffer the content mapped by the container fields</span>
            <span class="n">item</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

            <span class="c1"># Content of the buffer mapped by the container fields</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">:]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">!=</span> <span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># Not correct filled buffer!</span>
                <span class="k">raise</span> <span class="ne">BufferError</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">Patch</span><span class="p">(</span><span class="n">content</span><span class="p">,</span>
                         <span class="n">index</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">byte_order</span><span class="p">,</span>
                         <span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
                         <span class="mi">0</span><span class="p">,</span>
                         <span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="c1"># Field index</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">index</span>
            <span class="c1"># Field alignment</span>
            <span class="n">alignment</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">alignment</span>

            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span> <span class="o">!=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">:</span>
                <span class="c1"># Bad aligned field?</span>
                <span class="k">raise</span> <span class="n">FieldGroupOffsetError</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span><span class="p">))</span>

            <span class="c1"># Create a dummy byte array filled with zero bytes.</span>
            <span class="c1"># The dummy byte array is necessary because the length of</span>
            <span class="c1"># the buffer must correlate to the field index of the</span>
            <span class="c1"># appending field group.</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span> <span class="o">*</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">)</span>

            <span class="c1"># Append to the buffer the content mapped by the field</span>
            <span class="n">item</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

            <span class="c1"># Content of the buffer mapped by the field group</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">:]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">!=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">:</span>
                <span class="c1"># Not correct filled buffer!</span>
                <span class="k">raise</span> <span class="ne">BufferError</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span><span class="p">)</span>

            <span class="c1"># Patch size in bytes for the field in the content buffer</span>
            <span class="n">patch_size</span><span class="p">,</span> <span class="n">bit_offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">bit_size</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bit_offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">inject</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">patch_size</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inject</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Patch offset in bytes for the field in the content buffer</span>
            <span class="n">patch_offset</span><span class="p">,</span> <span class="n">bit_offset</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bit_offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">inject</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="n">Byteorder</span><span class="o">.</span><span class="n">big</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span> <span class="o">-</span> <span class="p">(</span><span class="n">patch_offset</span> <span class="o">+</span> <span class="n">patch_size</span><span class="p">)</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">byte_size</span> <span class="o">-</span> <span class="n">patch_offset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">patch_offset</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">patch_offset</span> <span class="o">+</span> <span class="n">patch_size</span>

            <span class="k">return</span> <span class="n">Patch</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">],</span>
                         <span class="n">index</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">start</span><span class="p">,</span>
                         <span class="n">byte_order</span><span class="p">,</span>
                         <span class="n">item</span><span class="o">.</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">bit_offset</span><span class="p">,</span>
                         <span class="n">inject</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pointer.write_to"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.write_to">[docs]</a>    <span class="k">def</span> <span class="nf">write_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">):</span>
        <span class="sd">""" Writes via a data :class:`Provider` the :class:`Field` values of</span>
<span class="sd">        the given *item* to the `data source`.</span>

<span class="sd">        :param Provider provider: data :class:`Provider`.</span>
<span class="sd">        :param item: item to write.</span>
<span class="sd">        :param byte_order: encoding :class:`Byteorder`.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        """</span>
        <span class="c1"># Create memory patch for the item to write</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">patch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">is_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">patch</span><span class="o">.</span><span class="n">inject</span><span class="p">:</span>
                <span class="c1"># Unpatched content of the memory area in the data source to modify</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span>

                <span class="c1"># Decimal value of the memory area to patch</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Inject memory patch content</span>
                <span class="n">bit_mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">patch</span><span class="o">.</span><span class="n">bit_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">patch</span><span class="o">.</span><span class="n">bit_offset</span><span class="p">)</span>
                <span class="n">bit_mask</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">&amp;=</span> <span class="n">bit_mask</span>
                <span class="n">value</span> <span class="o">|=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Patched content for the memory area in the data source</span>
                <span class="n">buffer</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">),</span> <span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="n">provider</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">provider</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProviderTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pointer.deserialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.deserialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" De-serializes the `Pointer` field from the byte *buffer* starting</span>
<span class="sd">        at the begin of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        bytes to the :attr:`value` of the `Pointer` field in accordance with</span>
<span class="sd">        the decoding *byte order* for the de-serialization and the decoding</span>
<span class="sd">        :attr:`byte_order` of the `Pointer` field.</span>

<span class="sd">        The specific decoding :attr:`byte_order` of the `Pointer` field</span>
<span class="sd">        overrules the decoding *byte order* for the de-serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the `Pointer` field.</span>

<span class="sd">        Optional the de-serialization of the referenced :attr:`data` object of</span>
<span class="sd">        the `Pointer` field can be enabled.</span>

<span class="sd">        :param bytes buffer: byte stream.</span>
<span class="sd">        :param Index index: current read :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: decoding byte order for the de-serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` a `Pointer` field de-serialize its</span>
<span class="sd">            referenced :attr:`data` object as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the de-serialization of its</span>
<span class="sd">            referenced :attr:`data` object its own :attr:`bytestream`.</span>
<span class="sd">        """</span>
        <span class="c1"># Field</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c1"># Data Object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="n">options</span><span class="p">[</span><span class="n">Option</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_byte_order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span><span class="p">,</span>
                                   <span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                         <span class="kc">False</span><span class="p">),</span>
                                   <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Pointer.serialize"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.serialize">[docs]</a>    <span class="nd">@byte_order_option</span><span class="p">()</span>
    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Serializes the `Pointer` field to the byte *buffer* starting at the</span>
<span class="sd">        begin of the *buffer* or with the given *index* by mapping the</span>
<span class="sd">        :attr:`value` of the `Pointer` field to the byte *buffer* in accordance</span>
<span class="sd">        with the encoding *byte order*  for the serialization and the encoding</span>
<span class="sd">        :attr:`byte_order` of the `Pointer` field.</span>

<span class="sd">        The specific encoding :attr:`byte_order` of the `Poiner` field overrules</span>
<span class="sd">        the encoding *byte order* for the serialization.</span>

<span class="sd">        Returns the :class:`Index` of the *buffer* after the `Pointer` field.</span>

<span class="sd">        Optional the serialization of the referenced :attr:`data` object of the</span>
<span class="sd">        `Pointer` field can be enabled.</span>

<span class="sd">        :param bytearray buffer: byte stream.</span>
<span class="sd">        :param Index index: current write :class:`Index` within the *buffer*.</span>
<span class="sd">        :keyword byte_order: encoding byte order for the serialization.</span>
<span class="sd">        :type byte_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">        :keyword bool nested: if ``True`` a `Pointer` field serializes its</span>
<span class="sd">            referenced :attr:`data` object as well (chained method call).</span>
<span class="sd">            Each :class:`Pointer` field uses for the serialization of its</span>
<span class="sd">            referenced :attr:`data` object its own :attr:`bytestream`.</span>
<span class="sd">        """</span>
        <span class="c1"># Field</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c1"># Data Object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="n">options</span><span class="p">[</span><span class="n">Option</span><span class="o">.</span><span class="n">byte_order</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_byte_order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span><span class="p">,</span>
                                 <span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                       <span class="kc">False</span><span class="p">),</span>
                                 <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Pointer.initialize_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.initialize_fields">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">""" Initializes the `Pointer` field itself and the :class:`Field` items</span>
<span class="sd">        in the :attr:`data` object referenced by the `Pointer` field with the</span>
<span class="sd">        *values* in the *content* dictionary.</span>

<span class="sd">        The ``['value']`` key in the *content* dictionary refers to the `Pointer`</span>
<span class="sd">        field itself and the ``['data']`` key refers to the :attr:`data` object</span>
<span class="sd">        referenced by the `Pointer` field.</span>

<span class="sd">        :param dict content: a dictionary contains the :class:`~Field.value`</span>
<span class="sd">            for the `Pointer` field and the :class:`~Field.value` for each</span>
<span class="sd">            :class:`Field` in the :attr:`data` object referenced by the</span>
<span class="sd">            `Pointer` field.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">'value'</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">'data'</span><span class="p">:</span>
                <span class="c1"># Container or Pointer</span>
                <span class="k">if</span> <span class="n">is_mixin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">initialize_fields</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="c1"># Field</span>
                <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Pointer.index_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.index_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">index_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Indexes the `Pointer` field and the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field starting with the given *index* and returns the</span>
<span class="sd">        :class:`Index` after the `Pointer` field.</span>

<span class="sd">        :param Index index: :class:`Index` for the `Pointer` field.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`data` object referenced by the `Pointer` field indexes their</span>
<span class="sd">            referenced :attr:`~Pointer.data` object fields as well</span>
<span class="sd">            (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Container</span>
        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_fields</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                          <span class="kc">False</span><span class="p">),</span>
                                    <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c1"># Pointer</span>
        <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_fields</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                          <span class="kc">False</span><span class="p">),</span>
                                    <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index_field</span><span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span><span class="p">,</span>
                                         <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">index</span></div>

<div class="viewcode-block" id="Pointer.view_fields"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.view_fields">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">view_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a :class:`dict` which contains the selected field</span>
<span class="sd">        *attributes* of the `Pointer` field itself extended with a ``['data']``</span>
<span class="sd">        key which contains the selected field *attribute* or the dictionaries of</span>
<span class="sd">        the selected field *attributes* for each :class:`Field` *nested* in the</span>
<span class="sd">        :attr:`data` object referenced by the `Pointer` field.</span>

<span class="sd">        The *attributes* of each :class:`Field` for containers *nested* in the</span>
<span class="sd">        :attr:`data` object referenced by the `Pointer` field are viewed as well</span>
<span class="sd">        (chained method call).</span>

<span class="sd">        :param str attributes: selected :class:`Field` attributes.</span>
<span class="sd">            Fallback is the field :attr:`~Field.value`.</span>
<span class="sd">        :keyword tuple fieldnames: sequence of dictionary keys for the selected</span>
<span class="sd">            field *attributes*. Defaults to ``(*attributes)``.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`data` object referenced by the `Pointer` field views their</span>
<span class="sd">            referenced :attr:`~Pointer.data` object field attributes as well</span>
<span class="sd">            (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Pointer field</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">field_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">items</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Data object</span>
        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="c1"># Container</span>
            <span class="n">items</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="c1"># Pointer</span>
            <span class="n">items</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">view_fields</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="c1"># Field</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_getter</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'fieldnames'</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                <span class="n">items</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">field_getter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">items</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_getter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># None</span>
            <span class="n">items</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="Pointer.field_items"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.field_items">[docs]</a>    <span class="nd">@nested_option</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">field_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns a **flatten** list of ``('field path', field item)`` tuples</span>
<span class="sd">        for the `Pointer` field itself and for each :class:`Field` *nested* in the</span>
<span class="sd">        :attr:`data` object referenced by the `Pointer` field.</span>

<span class="sd">        :param str path: path of the `Pointer` field.</span>
<span class="sd">        :keyword bool nested: if ``True`` all :class:`Pointer` fields in the</span>
<span class="sd">            :attr:`data` object referenced by the `Pointer` field lists their</span>
<span class="sd">            referenced :attr:`~Pointer.data` object field items as well</span>
<span class="sd">            (chained method call).</span>
<span class="sd">        """</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># Field</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">path</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="s1">'field'</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="c1"># Data Object</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.data"</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="s1">'data'</span>
        <span class="c1"># Container</span>
        <span class="k">if</span> <span class="n">is_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_item</span><span class="p">)</span>
        <span class="c1"># Pointer</span>
        <span class="k">elif</span> <span class="n">is_pointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">field_items</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_item</span><span class="p">)</span>
        <span class="c1"># Field</span>
        <span class="k">elif</span> <span class="n">is_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="Pointer.describe"><a class="viewcode-back" href="../../api/index.html#konfoo.Pointer.describe">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">""" Returns the **metadata** of a `Pointer` as a :class:`dict`.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            metadata = {</span>
<span class="sd">                'address': self.index.address,</span>
<span class="sd">                'alignment': [self.alignment.byte_size, self.alignment.bit_offset],</span>
<span class="sd">                'class': self.__class__.__name__,</span>
<span class="sd">                'index': [self.index.byte, self.index.bit],</span>
<span class="sd">                'max': self.max(),</span>
<span class="sd">                'min': self.min(),</span>
<span class="sd">                'name': name if name else self.__class__.__name__,</span>
<span class="sd">                'order': self.byte_order.value,</span>
<span class="sd">                'size': self.bit_size,</span>
<span class="sd">                'type': Pointer.item_type.name,</span>
<span class="sd">                'value': self.value,</span>
<span class="sd">                'member': [self.data.describe()]</span>
<span class="sd">            }</span>

<span class="sd">        :param str name: optional name for the `Pointer` field.</span>
<span class="sd">            Fallback is the class name.</span>
<span class="sd">        :keyword bool nested: if ``True`` a :class:`Pointer` field lists its</span>
<span class="sd">            referenced :attr:`data` object fields as well (chained method call).</span>
<span class="sd">            Default is ``True``.</span>
<span class="sd">        """</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pointer</span><span class="o">.</span><span class="n">item_type</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">is_any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">get_nested</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">'member'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">'member'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metadata</span></div></div>


<div class="viewcode-block" id="StructurePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StructurePointer">[docs]</a><span class="k">class</span> <span class="nc">StructurePointer</span><span class="p">(</span><span class="n">Pointer</span><span class="p">):</span>
    <span class="sd">""" A `StructurePointer` field is a :class:`Pointer` which refers</span>
<span class="sd">    to a :class:`Structure`.</span>

<span class="sd">    :param template: template for the :attr:`data` object referenced by the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">        The *template* must be a :class:`Structure` instance.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `Pointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StructurePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    {}</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [name for name in pointer.keys()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; [member.value for member in pointer.values()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; [(name, member.value) for name, member in pointer.items()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StructurePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StructurePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Structure',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Structure',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': {}}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": {}}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StructurePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                   address=0, base_address=0,</span>
<span class="sd">                                   update=False),</span>
<span class="sd">                       alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                       bit_size=32,</span>
<span class="sd">                       value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('StructurePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'StructurePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_structure</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="SequencePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer">[docs]</a><span class="k">class</span> <span class="nc">SequencePointer</span><span class="p">(</span><span class="n">Pointer</span><span class="p">):</span>
    <span class="sd">""" A `SequencePointer` field is a :class:`Pointer` field which</span>
<span class="sd">    refers to a :class:`Sequence`.</span>

<span class="sd">    A `SequencePointer` field is:</span>

<span class="sd">    * *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">      of the referenced :class:`Sequence`.</span>
<span class="sd">    * *sized*: ``len(self)`` returns the number of items in the referenced</span>
<span class="sd">      :class:`Sequence`.</span>
<span class="sd">    * *indexable* ``self[index]`` returns the *item* at the *index* of the</span>
<span class="sd">      referenced :class:`Sequence`.</span>
<span class="sd">    * *iterable* ``iter(self)`` iterates over the *items* of the referenced</span>
<span class="sd">      :class:`Sequence`</span>

<span class="sd">    A `SequencePointer` field supports the usual methods for sequences:</span>

<span class="sd">    * **Append** an item to the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`append()`.</span>
<span class="sd">    * **Insert** an item before the *index* into the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`insert()`.</span>
<span class="sd">    * **Extend** the referenced :class:`Sequence` with items</span>
<span class="sd">      via :meth:`extend()`.</span>
<span class="sd">    * **Clear** the referenced :class:`Sequence` via :meth:`clear()`.</span>
<span class="sd">    * **Pop** an item with the *index* from the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`pop()`.</span>
<span class="sd">    * **Remove** the first occurrence of an *item* from the referenced</span>
<span class="sd">      :class:`Sequence` via :meth:`remove()`.</span>
<span class="sd">    * **Reverse** all items in the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`reverse()`.</span>

<span class="sd">    :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">        :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">        *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">        is appended to the :class:`Sequence`.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `Pointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = SequencePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer).hex()</span>
<span class="sd">    '00000000'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [item for item in pointer]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer[:]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.append(Field())</span>
<span class="sd">    &gt;&gt;&gt; pointer[0]</span>
<span class="sd">    Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">          bit_size=0,</span>
<span class="sd">          value=None)</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; pointer.pop()</span>
<span class="sd">    Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">          bit_size=0,</span>
<span class="sd">          value=None)</span>
<span class="sd">    &gt;&gt;&gt; pointer.insert(0, Field())</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    [Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value=None)]</span>
<span class="sd">    &gt;&gt;&gt; pointer.remove(pointer[0])</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.clear()</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'SequencePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'SequencePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Sequence',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Sequence',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': []}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": []}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      SequencePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                  address=0, base_address=0,</span>
<span class="sd">                                  update=False),</span>
<span class="sd">                      alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                      bit_size=32,</span>
<span class="sd">                      value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('SequencePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'SequencePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">Sequence</span><span class="p">(</span><span class="n">iterable</span><span class="p">),</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

<div class="viewcode-block" id="SequencePointer.append"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Appends the *item* to the end of the :class:`Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequencePointer.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Inserts the *item* before the *index* into the :class:`Sequence`.</span>

<span class="sd">        :param int index: :class:`Sequence` index.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequencePointer.pop"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">""" Removes and returns the item at the *index* from the</span>
<span class="sd">        :class:`Sequence`.</span>

<span class="sd">        :param int index: :class:`Sequence` index.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequencePointer.clear"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Remove all items from the :class:`Sequence`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="SequencePointer.remove"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Removes the first occurrence of an *item* from the :class:`Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequencePointer.reverse"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" In place reversing of the :class:`Sequence` items."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></div>

<div class="viewcode-block" id="SequencePointer.extend"><a class="viewcode-back" href="../../api/index.html#konfoo.SequencePointer.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">""" Extends the :class:`Sequence` by appending items from the *iterable*.</span>

<span class="sd">        :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">            :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">            *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">            is appended to the :class:`Sequence`.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ArrayPointer"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayPointer">[docs]</a><span class="k">class</span> <span class="nc">ArrayPointer</span><span class="p">(</span><span class="n">SequencePointer</span><span class="p">):</span>
    <span class="sd">""" An `ArrayPointer` field is a :class:`SequencePointer` field which</span>
<span class="sd">    refers to a :class:`Array`.</span>

<span class="sd">    An `ArrayPointer` field adapts and extends a :class:`SequencePointer`</span>
<span class="sd">    field with the following features:</span>

<span class="sd">    *   **Append** a new :class:`Array` element to the referenced :class:`Array`</span>
<span class="sd">        via :meth:`append()`.</span>
<span class="sd">    *   **Insert** a new :class:`Array` element before the *index*</span>
<span class="sd">        into the referenced :class:`Array` via :meth:`insert()`.</span>
<span class="sd">    *   **Re-size** the referenced :class:`Array` via :meth:`resize()`.</span>

<span class="sd">    :param template: template for the :class:`Array` element.</span>
<span class="sd">        The *template* can be any :class:`Field` instance or any *callable*</span>
<span class="sd">        that returns a :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">        or any :class:`Field` instance.</span>
<span class="sd">    :param int size: is the size of the :class:`Array` in number of</span>
<span class="sd">        :class:`Array` elements.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `Pointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = ArrayPointer(Byte)</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [item for item in pointer]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer[:]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.append()</span>
<span class="sd">    &gt;&gt;&gt; pointer[0]</span>
<span class="sd">    Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">         alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">         bit_size=8,</span>
<span class="sd">         value='0x0')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; pointer.pop()</span>
<span class="sd">    Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">         alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">         bit_size=8,</span>
<span class="sd">         value='0x0')</span>
<span class="sd">    &gt;&gt;&gt; pointer.insert(0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    [Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">          bit_size=8,</span>
<span class="sd">          value='0x0')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.remove(pointer[0])</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.clear()</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'ArrayPointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'ArrayPointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Array',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Array',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': []}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": []}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      ArrayPointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                               address=0, base_address=0,</span>
<span class="sd">                               update=False),</span>
<span class="sd">                   alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                   bit_size=32,</span>
<span class="sd">                   value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('ArrayPointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'ArrayPointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

<div class="viewcode-block" id="ArrayPointer.append"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayPointer.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Appends a new :class:`Array` element to the :class:`Array`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArrayPointer.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayPointer.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">""" Inserts a new :class:`Array` element before the *index*</span>
<span class="sd">        of the :class:`Array`.</span>

<span class="sd">        :param int index: :class:`Array` index.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArrayPointer.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayPointer.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the :class:`Array` by appending new :class:`Array` elements</span>
<span class="sd">        or removing :class:`Array` elements from the end.</span>

<span class="sd">        :param int size: new size of the :class:`Array` in number of</span>
<span class="sd">            :class:`Array` elements.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">Array</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StreamPointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StreamPointer">[docs]</a><span class="k">class</span> <span class="nc">StreamPointer</span><span class="p">(</span><span class="n">Pointer</span><span class="p">):</span>
    <span class="sd">""" A `StreamPointer` field is a :class:`Pointer` field which</span>
<span class="sd">    refers to a :class:`Stream` field.</span>

<span class="sd">    A `StreamPointer` field is:</span>

<span class="sd">    * *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">      of the referenced :class:`Stream` field.</span>
<span class="sd">    * *sized*: ``len(self)`` returns the length of the referenced</span>
<span class="sd">      :class:`Stream` field.</span>
<span class="sd">    * *indexable* ``self[index]`` returns the *byte* at the *index*</span>
<span class="sd">      of the referenced  :class:`Stream` field.</span>
<span class="sd">    * *iterable* ``iter(self)`` iterates over the bytes of the referenced</span>
<span class="sd">      :class:`Stream` field.</span>

<span class="sd">    :param int size: is the size of the :class:`Stream` field in bytes.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StreamPointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    Stream(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value='')</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data().hex()</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=10, bit=0, address=4294967305, base_address=4294967295, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in pointer]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [hex(byte) for byte in pointer]</span>
<span class="sd">    ['0x4b', '0x6f', '0x6e', '0x46', '0x6f', '0x6f', '0x20', '0x69', '0x73', '0x20']</span>
<span class="sd">    &gt;&gt;&gt; pointer[5]  # converts to int</span>
<span class="sd">    111</span>
<span class="sd">    &gt;&gt;&gt; 111 in pointer</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in pointer</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; pointer[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StreamPointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StreamPointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'address': 4294967295,</span>
<span class="sd">         'alignment': [10, 0],</span>
<span class="sd">         'class': 'Stream10',</span>
<span class="sd">         'index': [0, 0],</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'order': 'auto',</span>
<span class="sd">         'size': 80,</span>
<span class="sd">         'type': 'Field',</span>
<span class="sd">         'value': '4b6f6e466f6f20697320'}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': '4b6f6e466f6f20697320'}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": "4b6f6e466f6f20697320"}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StreamPointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                address=0, base_address=0,</span>
<span class="sd">                                update=False),</span>
<span class="sd">                    alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                    bit_size=32,</span>
<span class="sd">                    value='0xffffffff')),</span>
<span class="sd">     ('data',</span>
<span class="sd">      Stream(index=Index(byte=0, bit=0,</span>
<span class="sd">                         address=4294967295, base_address=4294967295,</span>
<span class="sd">                         update=False),</span>
<span class="sd">             alignment=Alignment(byte_size=10, bit_offset=0),</span>
<span class="sd">             bit_size=80,</span>
<span class="sd">             value='4b6f6e466f6f20697320'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('StreamPointer.field', '0xffffffff'),</span>
<span class="sd">     ('StreamPointer.data', '4b6f6e466f6f20697320')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'StreamPointer': {'field': '0xffffffff', 'data': '4b6f6e466f6f20697320'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">Stream</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

<div class="viewcode-block" id="StreamPointer.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.StreamPointer.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the :class:`Stream` field by appending zero bytes or</span>
<span class="sd">        removing bytes from the end.</span>

<span class="sd">        :param int size: :class:`Stream` size in number of bytes.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StringPointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StringPointer">[docs]</a><span class="k">class</span> <span class="nc">StringPointer</span><span class="p">(</span><span class="n">StreamPointer</span><span class="p">):</span>
    <span class="sd">""" A `StringPointer` field is a :class:`StreamPointer` field  which</span>
<span class="sd">    refers to a :class:`String` field.</span>

<span class="sd">    :param int size: is the *size* of the :class:`String` field in bytes.</span>
<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StringPointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    String(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value='')</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data().hex()</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=10, bit=0, address=4294967305, base_address=4294967295, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in pointer]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [chr(byte) for byte in pointer]  # converts to int</span>
<span class="sd">    ['K', 'o', 'n', 'F', 'o', 'o', ' ', 'i', 's', ' ']</span>
<span class="sd">    &gt;&gt;&gt; chr(pointer[5])  # converts to int -&gt; chr</span>
<span class="sd">    'o'</span>
<span class="sd">    &gt;&gt;&gt; ord(' ') in pointer</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in pointer</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; pointer[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StringPointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StringPointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'address': 4294967295,</span>
<span class="sd">         'alignment': [10, 0],</span>
<span class="sd">         'class': 'String10',</span>
<span class="sd">         'index': [0, 0],</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'order': 'auto',</span>
<span class="sd">         'size': 80,</span>
<span class="sd">         'type': 'Field',</span>
<span class="sd">         'value': 'KonFoo is '}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': 'KonFoo is '}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": "KonFoo is "}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StringPointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                address=0, base_address=0,</span>
<span class="sd">                                update=False),</span>
<span class="sd">                    alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                    bit_size=32,</span>
<span class="sd">                    value='0xffffffff')),</span>
<span class="sd">     ('data',</span>
<span class="sd">      String(index=Index(byte=0, bit=0,</span>
<span class="sd">                         address=4294967295, base_address=4294967295,</span>
<span class="sd">                         update=False),</span>
<span class="sd">             alignment=Alignment(byte_size=10, bit_offset=0),</span>
<span class="sd">             bit_size=80,</span>
<span class="sd">             value='KonFoo is '))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('StringPointer.field', '0xffffffff'),</span>
<span class="sd">     ('StringPointer.data', 'KonFoo is ')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'StringPointer': {'field': '0xffffffff', 'data': 'KonFoo is '}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="AutoStringPointer"><a class="viewcode-back" href="../../api/index.html#konfoo.AutoStringPointer">[docs]</a><span class="k">class</span> <span class="nc">AutoStringPointer</span><span class="p">(</span><span class="n">StringPointer</span><span class="p">):</span>
    <span class="sd">""" An `AutoStringPointer` field is a :class:`StringPointer` field which</span>
<span class="sd">    refers to an auto-sized :class:`String` field.</span>

<span class="sd">    :param int address: absolute address of the :attr:`data` object referenced</span>
<span class="sd">        by the `Pointer` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `Pointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `Pointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `Pointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `Pointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `Pointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = AutoStringPointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    String(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=64, bit_offset=0),</span>
<span class="sd">           bit_size=512,</span>
<span class="sd">           value='')</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    64</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    64</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data().hex()</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=10, bit=0, address=4294967305, base_address=4294967295, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in pointer]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [chr(byte) for byte in pointer]  # converts to int</span>
<span class="sd">    ['K', 'o', 'n', 'F', 'o', 'o', ' ', 'i', 's', ' ']</span>
<span class="sd">    &gt;&gt;&gt; chr(pointer[5])  # converts to int -&gt; chr</span>
<span class="sd">    'o'</span>
<span class="sd">    &gt;&gt;&gt; ord(' ') in pointer</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in pointer</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; pointer[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'AutoStringPointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'AutoStringPointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'address': 4294967295,</span>
<span class="sd">         'alignment': [10, 0],</span>
<span class="sd">         'class': 'String10',</span>
<span class="sd">         'index': [0, 0],</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'order': 'auto',</span>
<span class="sd">         'size': 80,</span>
<span class="sd">         'type': 'Field',</span>
<span class="sd">         'value': 'KonFoo is '}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': 'KonFoo is '}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": "KonFoo is "}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      AutoStringPointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                address=0, base_address=0,</span>
<span class="sd">                                update=False),</span>
<span class="sd">                        alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                        bit_size=32,</span>
<span class="sd">                        value='0xffffffff')),</span>
<span class="sd">     ('data',</span>
<span class="sd">      String(index=Index(byte=0, bit=0,</span>
<span class="sd">                         address=4294967295, base_address=4294967295,</span>
<span class="sd">                         update=False),</span>
<span class="sd">             alignment=Alignment(byte_size=10, bit_offset=0),</span>
<span class="sd">             bit_size=80,</span>
<span class="sd">             value='KonFoo is '))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('AutoStringPointer.field', '0xffffffff'),</span>
<span class="sd">     ('AutoStringPointer.data', 'KonFoo is ')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'AutoStringPointer': {'field': '0xffffffff', 'data': 'KonFoo is '}}</span>
<span class="sd">    """</span>
    <span class="c1">#: Block size in *bytes* to read for the :class:`String` field.</span>
    <span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="c1">#: Maximal allowed address of the :class:`String` field.</span>
    <span class="n">MAX_ADDRESS</span> <span class="o">=</span> <span class="mh">0xffffffff</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">AutoStringPointer</span><span class="o">.</span><span class="n">BLOCK_SIZE</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

<div class="viewcode-block" id="AutoStringPointer.read_from"><a class="viewcode-back" href="../../api/index.html#konfoo.AutoStringPointer.read_from">[docs]</a>    <span class="nd">@nested_option</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">null_allowed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">is_provider</span><span class="p">(</span><span class="n">provider</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">null_allowed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ADDRESS</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">BLOCK_SIZE</span><span class="p">):</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLOCK_SIZE</span><span class="p">,</span>
                                  <span class="mi">0</span><span class="p">,</span>
                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_ADDRESS</span> <span class="o">-</span> <span class="n">address</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">+=</span> <span class="n">provider</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_data</span><span class="p">()</span>
                    <span class="c1"># Incomplete data object</span>
                    <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">length</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">byte</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">bit</span>
                        <span class="k">raise</span> <span class="n">ContainerLengthError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
                    <span class="c1"># Terminated?</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_terminated</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProviderTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.RelativePointer">[docs]</a><span class="k">class</span> <span class="nc">RelativePointer</span><span class="p">(</span><span class="n">Pointer</span><span class="p">):</span>
    <span class="sd">""" A `RelativePointer` field is a :class:`Pointer` field which references its</span>
<span class="sd">    :attr:`data` object relative to a **base address** in the *data source*.</span>

<span class="sd">    .. important::</span>
<span class="sd">        The :attr:`base_address` of a `RelativePointer` is defined by the field</span>
<span class="sd">        :attr:`~Field.index` of the `RelativePointer` field.</span>

<span class="sd">    :param template: template for the :attr:`data` object referenced by the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `RelativePointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = RelativePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=0, bit=0, address=4294967295, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b''</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'RelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'RelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff'}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': None}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": null}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      RelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                  address=0, base_address=0,</span>
<span class="sd">                                  update=False),</span>
<span class="sd">                      alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                      bit_size=32,</span>
<span class="sd">                      value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('RelativePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'RelativePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the *data source* address of the :attr:`data` object</span>
<span class="sd">        referenced by the `RelativePointer` field (read-only).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Returns the *data source* base address of the :attr:`data` object</span>
<span class="sd">        relative referenced by the `RelativePointer` field (read-only).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">base_address</span></div>


<div class="viewcode-block" id="StructureRelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StructureRelativePointer">[docs]</a><span class="k">class</span> <span class="nc">StructureRelativePointer</span><span class="p">(</span><span class="n">RelativePointer</span><span class="p">):</span>
    <span class="sd">""" A `StructureRelativePointer` field is a :class:`RelativePointer` which</span>
<span class="sd">    refers to a :class:`Structure`.</span>

<span class="sd">    :param template: template for the :attr:`data` object referenced by the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">        The *template* must be a :class:`Structure` instance.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `RelativePointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StructureRelativePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    {}</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [name for name in pointer.keys()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; [member.value for member in pointer.values()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; [(name, member.value) for name, member in pointer.items()]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StructureRelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StructureRelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Structure',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Structure',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': {}}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": {}}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StructureRelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                           address=0, base_address=0,</span>
<span class="sd">                                           update=False),</span>
<span class="sd">                               alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                               bit_size=32,</span>
<span class="sd">                               value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('StructureRelativePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'StructureRelativePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_structure</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemberTypeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="SequenceRelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer">[docs]</a><span class="k">class</span> <span class="nc">SequenceRelativePointer</span><span class="p">(</span><span class="n">RelativePointer</span><span class="p">):</span>
    <span class="sd">""" A `SequenceRelativePointer` field is a :class:`RelativePointer` which</span>
<span class="sd">    refers to a :class:`Sequence`.</span>

<span class="sd">    A `SequenceRelativePointer` is:</span>

<span class="sd">    * *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">      of the referenced :class:`Sequence`.</span>
<span class="sd">    * *sized*: ``len(self)`` returns the number of items in the referenced</span>
<span class="sd">      :class:`Sequence`.</span>
<span class="sd">    * *indexable* ``self[index]`` returns the *item* at the *index*</span>
<span class="sd">      of the referenced :class:`Sequence`.</span>
<span class="sd">    * *iterable* ``iter(self)`` iterates over the *items* of the referenced</span>
<span class="sd">      :class:`Sequence`</span>

<span class="sd">    A `SequenceRelativePointer` supports the usual methods:</span>

<span class="sd">    * **Append** an item to the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`append()`.</span>
<span class="sd">    * **Insert** an item before the *index* into the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`insert()`.</span>
<span class="sd">    * **Extend** the referenced :class:`Sequence` with items</span>
<span class="sd">      via :meth:`extend()`.</span>
<span class="sd">    * **Clear** the referenced :class:`Sequence` via :meth:`clear()`.</span>
<span class="sd">    * **Pop** an item with the *index* from the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`pop()`.</span>
<span class="sd">    * **Remove** the first occurrence of an *item* from the referenced</span>
<span class="sd">      :class:`Sequence` via :meth:`remove()`.</span>
<span class="sd">    * **Reverse** all items in the referenced :class:`Sequence`</span>
<span class="sd">      via :meth:`reverse()`.</span>

<span class="sd">    :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">        :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">        *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">        is appended to the :class:`Sequence`.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `RelativePointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = SequenceRelativePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [item for item in pointer]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer[:]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.append(Field())</span>
<span class="sd">    &gt;&gt;&gt; pointer[0]</span>
<span class="sd">    Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">          bit_size=0,</span>
<span class="sd">          value=None)</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; pointer.pop()</span>
<span class="sd">    Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">          bit_size=0,</span>
<span class="sd">          value=None)</span>
<span class="sd">    &gt;&gt;&gt; pointer.insert(0, Field())</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    [Field(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value=None)]</span>
<span class="sd">    &gt;&gt;&gt; pointer.remove(pointer[0])</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.clear()</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'SequenceRelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'SequenceRelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Sequence',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Sequence',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': []}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": []}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      SequenceRelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                          address=0, base_address=0,</span>
<span class="sd">                                          update=False),</span>
<span class="sd">                              alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                              bit_size=32,</span>
<span class="sd">                              value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('SequenceRelativePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'SequenceRelativePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">Sequence</span><span class="p">(</span><span class="n">iterable</span><span class="p">),</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

<div class="viewcode-block" id="SequenceRelativePointer.append"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Appends the *item* to the end of the :class:`Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Inserts the *item* before the *index* into the :class:`Sequence`.</span>

<span class="sd">        :param int index: :class:`Sequence` index.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.pop"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">""" Removes and returns the item at the *index* from the</span>
<span class="sd">        :class:`Sequence`.</span>

<span class="sd">        :param int index: :class:`Sequence` index</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.clear"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Remove all items from the :class:`Sequence`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.remove"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">""" Removes the first occurrence of an *item* from the :class:`Sequence`.</span>

<span class="sd">        :param item: any :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">            or :class:`Field` instance.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.reverse"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" In place reversing of the :class:`Sequence` items."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></div>

<div class="viewcode-block" id="SequenceRelativePointer.extend"><a class="viewcode-back" href="../../api/index.html#konfoo.SequenceRelativePointer.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">""" Extends the :class:`Sequence` by appending items from the *iterable*.</span>

<span class="sd">        :param iterable: any *iterable* that contains items of :class:`Structure`,</span>
<span class="sd">            :class:`Sequence`, :class:`Array` or :class:`Field` instances. If the</span>
<span class="sd">            *iterable* is one of these instances itself then the *iterable* itself</span>
<span class="sd">            is appended to the :class:`Sequence`.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ArrayRelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayRelativePointer">[docs]</a><span class="k">class</span> <span class="nc">ArrayRelativePointer</span><span class="p">(</span><span class="n">SequenceRelativePointer</span><span class="p">):</span>
    <span class="sd">""" An `ArrayRelativePointer` field is a :class:`SequenceRelativePointer`</span>
<span class="sd">    which refers to a :class:`Array`.</span>

<span class="sd">    An `ArrayRelativePointer` adapts and extends a :class:`SequenceRelativePointer`</span>
<span class="sd">    with the following features:</span>

<span class="sd">    *   **Append** a new :class:`Array` element to the :class:`Array`</span>
<span class="sd">        via :meth:`append()`.</span>
<span class="sd">    *   **Insert** a new :class:`Array` element before the *index*</span>
<span class="sd">        into the :class:`Array` via :meth:`insert()`.</span>
<span class="sd">    *   **Re-size** the :class:`Array` via :meth:`resize()`.</span>

<span class="sd">    :param template: template for the :class:`Array` element.</span>
<span class="sd">        The *template* can be any :class:`Field` instance or any *callable*</span>
<span class="sd">        that returns a :class:`Structure`, :class:`Sequence`, :class:`Array`</span>
<span class="sd">        or any :class:`Field` instance.</span>
<span class="sd">    :param int size: is the size of the :class:`Array` in number of</span>
<span class="sd">        :class:`Array` elements.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param data_order: byte order used to unpack and pack the :attr:`data`</span>
<span class="sd">        object referenced by the `RelativePointer` field.</span>
<span class="sd">    :type data_order: :class:`Byteorder`, :class:`str`</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>


<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = ArrayRelativePointer(Byte)</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; [item for item in pointer]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer[:]</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.append()</span>
<span class="sd">    &gt;&gt;&gt; pointer[0]</span>
<span class="sd">    Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">         alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">         bit_size=8,</span>
<span class="sd">         value='0x0')</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; pointer.pop()</span>
<span class="sd">    Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">         alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">         bit_size=8,</span>
<span class="sd">         value='0x0')</span>
<span class="sd">    &gt;&gt;&gt; pointer.insert(0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    [Byte(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">          alignment=Alignment(byte_size=1, bit_offset=0),</span>
<span class="sd">          bit_size=8,</span>
<span class="sd">          value='0x0')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.remove(pointer[0])</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.clear()</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'ArrayRelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'ArrayRelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'class': 'Array',</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'size': 0,</span>
<span class="sd">         'type': 'Array',</span>
<span class="sd">         'member': []}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': []}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": []}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      ArrayRelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                       address=0, base_address=0,</span>
<span class="sd">                                       update=False),</span>
<span class="sd">                           alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                           bit_size=32,</span>
<span class="sd">                           value='0xffffffff'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list(nested=True)</span>
<span class="sd">    [('ArrayRelativePointer.field', '0xffffffff')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict(nested=True)</span>
<span class="sd">    {'ArrayRelativePointer': {'field': '0xffffffff'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_order</span><span class="o">=</span><span class="n">BYTEORDER</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">data_order</span><span class="o">=</span><span class="n">data_order</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

<div class="viewcode-block" id="ArrayRelativePointer.append"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayRelativePointer.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">""" Appends a new :class:`Array` element to the :class:`Array`."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArrayRelativePointer.insert"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayRelativePointer.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">""" Inserts a new :class:`Array` element before the *index*</span>
<span class="sd">        of the :class:`Array`.</span>

<span class="sd">        :param int index: :class:`Array` index.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArrayRelativePointer.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.ArrayRelativePointer.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the :class:`Array` by appending new :class:`Array` elements</span>
<span class="sd">        or removing :class:`Array` elements from the end.</span>

<span class="sd">        :param int size: new size of the :class:`Array` in number of</span>
<span class="sd">            :class:`Array` elements.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">Array</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StreamRelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StreamRelativePointer">[docs]</a><span class="k">class</span> <span class="nc">StreamRelativePointer</span><span class="p">(</span><span class="n">RelativePointer</span><span class="p">):</span>
    <span class="sd">""" A `StreamRelativePointer` field is a :class:`RelativePointer` field</span>
<span class="sd">    which refers to a :class:`Stream` field.</span>

<span class="sd">    A `StreamRelativePointer` field is:</span>

<span class="sd">    * *containable*: ``item`` in ``self`` returns ``True`` if *item* is part</span>
<span class="sd">      of the referenced :class:`Stream` field.</span>
<span class="sd">    * *sized*: ``len(self)`` returns the length of the referenced</span>
<span class="sd">      :class:`Stream` field.</span>
<span class="sd">    * *indexable* ``self[index]`` returns the *byte* at the *index* of the</span>
<span class="sd">      referenced :class:`Stream` field.</span>
<span class="sd">    * *iterable* ``iter(self)`` iterates over the bytes of the referenced</span>
<span class="sd">      :class:`Stream` field.</span>

<span class="sd">    :param int size: is the size of the :class:`Stream` field in bytes.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StreamRelativePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    Stream(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value='')</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data().hex()</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=10, bit=0, address=4294967305, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in pointer]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [hex(byte) for byte in pointer]</span>
<span class="sd">    ['0x4b', '0x6f', '0x6e', '0x46', '0x6f', '0x6f', '0x20', '0x69', '0x73', '0x20']</span>
<span class="sd">    &gt;&gt;&gt; pointer[5]  # converts to int</span>
<span class="sd">    111</span>
<span class="sd">    &gt;&gt;&gt; 111 in pointer</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in pointer</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; pointer[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StreamRelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StreamRelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'address': 4294967295,</span>
<span class="sd">         'alignment': [10, 0],</span>
<span class="sd">         'class': 'Stream10',</span>
<span class="sd">         'index': [0, 0],</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'order': 'auto',</span>
<span class="sd">         'size': 80,</span>
<span class="sd">         'type': 'Field',</span>
<span class="sd">         'value': '4b6f6e466f6f20697320'}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': '4b6f6e466f6f20697320'}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": "4b6f6e466f6f20697320"}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StreamRelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                        address=0, base_address=0,</span>
<span class="sd">                                        update=False),</span>
<span class="sd">                            alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                            bit_size=32,</span>
<span class="sd">                            value='0xffffffff')),</span>
<span class="sd">     ('data',</span>
<span class="sd">      Stream(index=Index(byte=0, bit=0,</span>
<span class="sd">                         address=4294967295, base_address=0,</span>
<span class="sd">                         update=False),</span>
<span class="sd">             alignment=Alignment(byte_size=10, bit_offset=0),</span>
<span class="sd">             bit_size=80,</span>
<span class="sd">             value='4b6f6e466f6f20697320'))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('StreamRelativePointer.field', '0xffffffff'),</span>
<span class="sd">     ('StreamRelativePointer.data', '4b6f6e466f6f20697320')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'StreamRelativePointer': {'field': '0xffffffff', 'data': '4b6f6e466f6f20697320'}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">Stream</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

<div class="viewcode-block" id="StreamRelativePointer.resize"><a class="viewcode-back" href="../../api/index.html#konfoo.StreamRelativePointer.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">""" Re-sizes the :class:`Stream` field by appending zero bytes or</span>
<span class="sd">        removing bytes from the end.</span>

<span class="sd">        :param int size: :class:`Stream` size in number of bytes.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StringRelativePointer"><a class="viewcode-back" href="../../api/index.html#konfoo.StringRelativePointer">[docs]</a><span class="k">class</span> <span class="nc">StringRelativePointer</span><span class="p">(</span><span class="n">StreamRelativePointer</span><span class="p">):</span>
    <span class="sd">""" A `StringRelativePointer` field is a :class:`StreamRelativePointer`</span>
<span class="sd">    which refers to a :class:`String` field.</span>

<span class="sd">    :param int size: is the *size* of the :class:`String` field in bytes.</span>
<span class="sd">    :param int address: relative address of the :attr:`data` object referenced</span>
<span class="sd">        by the `RelativePointer` field.</span>
<span class="sd">    :param int bit_size: is the *size* of the `RelativePointer` field in bits,</span>
<span class="sd">        can be between ``1`` and ``64``.</span>
<span class="sd">    :param int align_to: aligns the `RelativePointer` field to the number of bytes,</span>
<span class="sd">        can be between ``1`` and ``8``.</span>
<span class="sd">        If no field *alignment* is set the `RelativePointer` field aligns itself</span>
<span class="sd">        to the next matching byte size according to the *size* of the</span>
<span class="sd">        `RelativePointer` field.</span>
<span class="sd">    :param field_order: byte order used to unpack and pack the :attr:`value`</span>
<span class="sd">        of the `RelativePointer` field.</span>
<span class="sd">    :type field_order: :class:`Byteorder`, :class:`str`</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; pointer = StringRelativePointer()</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_decimal()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_pointer()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.name</span>
<span class="sd">    'Pointer32'</span>
<span class="sd">    &gt;&gt;&gt; pointer.alignment</span>
<span class="sd">    Alignment(byte_size=4, bit_offset=0)</span>
<span class="sd">    &gt;&gt;&gt; pointer.byte_order</span>
<span class="sd">    Byteorder.auto = 'auto'</span>
<span class="sd">    &gt;&gt;&gt; pointer.index</span>
<span class="sd">    Index(byte=0, bit=0, address=0, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_field()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.bit_size</span>
<span class="sd">    32</span>
<span class="sd">    &gt;&gt;&gt; pointer.signed</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.min()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.max()</span>
<span class="sd">    4294967295</span>
<span class="sd">    &gt;&gt;&gt; pointer.base_address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.address</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.is_null()</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_signed()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.as_unsigned()</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data</span>
<span class="sd">    String(index=Index(byte=0, bit=0, address=0, base_address=0, update=False),</span>
<span class="sd">           alignment=Alignment(byte_size=0, bit_offset=0),</span>
<span class="sd">           bit_size=0,</span>
<span class="sd">           value='')</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_byte_order</span>
<span class="sd">    Byteorder.little = 'little'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    ''</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bytes(pointer)</span>
<span class="sd">    b'\\x00\\x00\\x00\\x00'</span>
<span class="sd">    &gt;&gt;&gt; int(pointer)</span>
<span class="sd">    0</span>
<span class="sd">    &gt;&gt;&gt; float(pointer)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hex(pointer)</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; bin(pointer)</span>
<span class="sd">    '0b0'</span>
<span class="sd">    &gt;&gt;&gt; oct(pointer)</span>
<span class="sd">    '0o0'</span>
<span class="sd">    &gt;&gt;&gt; bool(pointer)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize(bytes.fromhex('00c0'))</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xc000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x4000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x4000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = -0x1</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0x0'</span>
<span class="sd">    &gt;&gt;&gt; pointer.value = 0x100000000</span>
<span class="sd">    &gt;&gt;&gt; pointer.value</span>
<span class="sd">    '0xffffffff'</span>
<span class="sd">    &gt;&gt;&gt; bytestream = bytearray()</span>
<span class="sd">    &gt;&gt;&gt; bytestream</span>
<span class="sd">    bytearray(b'')</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize(bytestream)</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; bytestream.hex()</span>
<span class="sd">    'ffffffff'</span>
<span class="sd">    &gt;&gt;&gt; pointer.resize(10)</span>
<span class="sd">    &gt;&gt;&gt; pointer.data_size</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; len(pointer)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream = b'KonFoo is Fun'</span>
<span class="sd">    &gt;&gt;&gt; pointer.bytestream</span>
<span class="sd">    '4b6f6e466f6f2069732046756e'</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data().hex()</span>
<span class="sd">    '00000000000000000000'</span>
<span class="sd">    &gt;&gt;&gt; pointer.deserialize_data()</span>
<span class="sd">    Index(byte=10, bit=0, address=4294967305, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.serialize_data()</span>
<span class="sd">    b'KonFoo is '</span>
<span class="sd">    &gt;&gt;&gt; [byte for byte in pointer]  # converts to int</span>
<span class="sd">    [75, 111, 110, 70, 111, 111, 32, 105, 115, 32]</span>
<span class="sd">    &gt;&gt;&gt; [chr(byte) for byte in pointer]  # converts to int</span>
<span class="sd">    ['K', 'o', 'n', 'F', 'o', 'o', ' ', 'i', 's', ' ']</span>
<span class="sd">    &gt;&gt;&gt; chr(pointer[5])  # converts to int -&gt; chr</span>
<span class="sd">    'o'</span>
<span class="sd">    &gt;&gt;&gt; ord(' ') in pointer</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 0x0 in pointer</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; pointer[:6]  # converts to bytes</span>
<span class="sd">    b'KonFoo'</span>
<span class="sd">    &gt;&gt;&gt; pointer[3:6]  # converts to bytes</span>
<span class="sd">    b'Foo'</span>
<span class="sd">    &gt;&gt;&gt; pointer.describe()  #doctest: +SKIP</span>
<span class="sd">    {'address': 0,</span>
<span class="sd">     'alignment': [4, 0],</span>
<span class="sd">     'class': 'StringRelativePointer',</span>
<span class="sd">     'index': [0, 0],</span>
<span class="sd">     'max': 4294967295,</span>
<span class="sd">     'min': 0,</span>
<span class="sd">     'name': 'StringRelativePointer',</span>
<span class="sd">     'order': 'auto',</span>
<span class="sd">     'signed': False,</span>
<span class="sd">     'size': 32,</span>
<span class="sd">     'type': 'Pointer',</span>
<span class="sd">     'value': '0xffffffff',</span>
<span class="sd">     'member': [</span>
<span class="sd">        {'address': 4294967295,</span>
<span class="sd">         'alignment': [10, 0],</span>
<span class="sd">         'class': 'String10',</span>
<span class="sd">         'index': [0, 0],</span>
<span class="sd">         'name': 'data',</span>
<span class="sd">         'order': 'auto',</span>
<span class="sd">         'size': 80,</span>
<span class="sd">         'type': 'Field',</span>
<span class="sd">         'value': 'KonFoo is '}</span>
<span class="sd">     ]}</span>
<span class="sd">    &gt;&gt;&gt; pointer.index_fields()</span>
<span class="sd">    Index(byte=4, bit=0, address=4, base_address=0, update=False)</span>
<span class="sd">    &gt;&gt;&gt; pointer.view_fields()</span>
<span class="sd">    {'value': '0xffffffff', 'data': 'KonFoo is '}</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_json()</span>
<span class="sd">    '{"value": "0xffffffff", "data": "KonFoo is "}'</span>
<span class="sd">    &gt;&gt;&gt; pointer.field_items()</span>
<span class="sd">    [('field',</span>
<span class="sd">      StringRelativePointer(index=Index(byte=0, bit=0,</span>
<span class="sd">                                        address=0, base_address=0,</span>
<span class="sd">                                        update=False),</span>
<span class="sd">                            alignment=Alignment(byte_size=4, bit_offset=0),</span>
<span class="sd">                            bit_size=32,</span>
<span class="sd">                            value='0xffffffff')),</span>
<span class="sd">     ('data',</span>
<span class="sd">      String(index=Index(byte=0, bit=0,</span>
<span class="sd">                         address=4294967295, base_address=0,</span>
<span class="sd">                         update=False),</span>
<span class="sd">             alignment=Alignment(byte_size=10, bit_offset=0),</span>
<span class="sd">             bit_size=80,</span>
<span class="sd">             value='KonFoo is '))]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_list()</span>
<span class="sd">    [('StringRelativePointer.field', '0xffffffff'),</span>
<span class="sd">     ('StringRelativePointer.data', 'KonFoo is ')]</span>
<span class="sd">    &gt;&gt;&gt; pointer.to_dict()</span>
<span class="sd">    {'StringRelativePointer': {'field': '0xffffffff', 'data': 'KonFoo is '}}</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bit_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">align_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_order</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span>
                         <span class="n">bit_size</span><span class="o">=</span><span class="n">bit_size</span><span class="p">,</span>
                         <span class="n">align_to</span><span class="o">=</span><span class="n">align_to</span><span class="p">,</span>
                         <span class="n">field_order</span><span class="o">=</span><span class="n">field_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2015-2022, Jochen Gerhaeusser |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>